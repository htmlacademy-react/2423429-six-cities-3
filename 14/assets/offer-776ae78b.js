import{j as e,m as F,n as C,r as N,b as k,u as _,p as P,M as L,o as A,q as M,t as T,v as I,k as q,N as z,d as D,F as O,H as $,w as H,x as U,y as B}from"./index-23cc6a89.js";var w="NOT_FOUND";function G(s){var t;return{get:function(r){return t&&s(t.key,r)?t.value:w},put:function(r,i){t={key:r,value:i}},getEntries:function(){return t?[t]:[]},clear:function(){t=void 0}}}function W(s,t){var a=[];function r(o){var c=a.findIndex(function(f){return t(o,f.key)});if(c>-1){var n=a[c];return c>0&&(a.splice(c,1),a.unshift(n)),n.value}return w}function i(o,c){r(o)===w&&(a.unshift({key:o,value:c}),a.length>s&&a.pop())}function l(){return a}function d(){a=[]}return{get:r,put:i,getEntries:l,clear:d}}var X=function(t,a){return t===a};function Y(s){return function(a,r){if(a===null||r===null||a.length!==r.length)return!1;for(var i=a.length,l=0;l<i;l++)if(!s(a[l],r[l]))return!1;return!0}}function K(s,t){var a=typeof t=="object"?t:{equalityCheck:t},r=a.equalityCheck,i=r===void 0?X:r,l=a.maxSize,d=l===void 0?1:l,o=a.resultEqualityCheck,c=Y(i),n=d===1?G(c):W(d,c);function f(){var m=n.get(arguments);if(m===w){if(m=s.apply(null,arguments),o){var u=n.getEntries(),h=u.find(function(g){return o(g.value,m)});h&&(m=h.value)}n.put(arguments,m)}return m}return f.clearCache=function(){return n.clear()},f}function V(s){var t=Array.isArray(s[0])?s[0]:s;if(!t.every(function(r){return typeof r=="function"})){var a=t.map(function(r){return typeof r=="function"?"function "+(r.name||"unnamed")+"()":typeof r}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+a+"]")}return t}function J(s){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];var i=function(){for(var d=arguments.length,o=new Array(d),c=0;c<d;c++)o[c]=arguments[c];var n=0,f,m={memoizeOptions:void 0},u=o.pop();if(typeof u=="object"&&(m=u,u=o.pop()),typeof u!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof u+"]");var h=m,g=h.memoizeOptions,p=g===void 0?a:g,b=Array.isArray(p)?p:[p],x=V(o),v=s.apply(void 0,[function(){return n++,u.apply(null,arguments)}].concat(b)),E=s(function(){for(var S=[],R=x.length,y=0;y<R;y++)S.push(x[y].apply(null,arguments));return f=v.apply(null,S),f});return Object.assign(E,{resultFunc:u,memoizedResultFunc:v,dependencies:x,lastResult:function(){return f},recomputations:function(){return n},resetRecomputations:function(){return n=0}}),E};return i}var Q=J(K);function Z({offers:s,className:t="near-places__list places__list"}){return e.jsx("div",{className:"container",children:e.jsxs("section",{className:"near-places places",children:[e.jsx("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),e.jsx(F,{offers:s,className:t})]})})}function ee({review:s}){const t=new Date(s.date);return e.jsxs("li",{className:"reviews__item",children:[e.jsxs("div",{className:"reviews__user user",children:[e.jsx("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:e.jsx("img",{className:"reviews__avatar user__avatar",src:s.user.avatarUrl,width:"54",height:"54",alt:"Reviews avatar"})}),e.jsx("span",{className:"reviews__user-name",children:s.user.name}),s.user.isPro&&e.jsx("span",{className:"reviews__user-status",children:"Pro"})]}),e.jsxs("div",{className:"reviews__info",children:[e.jsx("div",{className:"reviews__rating rating",children:e.jsxs("div",{className:"reviews__stars rating__stars",children:[e.jsx("span",{style:{width:`${C({rating:s.rating})}%`}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]})}),e.jsx("p",{className:"reviews__text",children:s.comment}),e.jsx("time",{className:"reviews__time",dateTime:t.toISOString().slice(0,10),children:t.toLocaleString("default",{month:"long",year:"numeric"})})]})]},s.id)}const se=({reviews:s})=>e.jsxs(N.Fragment,{children:[e.jsxs("h2",{className:"reviews__title",children:["Reviews · ",e.jsx("span",{className:"reviews__amount",children:s.length})]}),e.jsx("ul",{className:"reviews__list",children:s.map(t=>e.jsx(ee,{review:t},t.id))})]}),re=s=>s.comments.comments,ae=s=>s.comments.isCommentsLoading,te=s=>s.comments.error,ne=s=>s.comments.isPosting,ie=s=>s.comments.postError,oe=[{value:5,title:"perfect"},{value:4,title:"good"},{value:3,title:"not bad"},{value:2,title:"badly"},{value:1,title:"terribly"}],ce=50,le=300;function fe({offerId:s}){const t=k(),a=_(ne),r=_(ie),[i,l]=N.useState({rating:0,comment:""}),d=i.rating>0&&i.comment.trim().length>=ce&&i.comment.trim().length<=le,o=n=>{const f=n.target,{name:m,value:u}=f;l(h=>({...h,[m]:m==="rating"?Number(u):u}))},c=()=>{!d||a||t(P({offerId:s,comment:i.comment.trim(),rating:i.rating})).unwrap().then(()=>{l({rating:0,comment:""})})};return e.jsxs("form",{className:"reviews__form form",onSubmit:n=>{n.preventDefault(),c()},children:[e.jsx("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),e.jsx("div",{className:"reviews__rating-form form__rating",children:oe.map(({value:n,title:f})=>e.jsxs(N.Fragment,{children:[e.jsx("input",{className:"form__rating-input visually-hidden",name:"rating",value:n,id:`${n}-stars`,type:"radio",checked:i.rating===n,onChange:o,disabled:a}),e.jsx("label",{htmlFor:`${n}-stars`,className:"reviews__rating-label form__rating-label",title:f,children:e.jsx("svg",{className:"form__star-image",width:"37",height:"33",children:e.jsx("use",{xlinkHref:"#icon-star"})})})]},n))}),e.jsx("textarea",{className:"reviews__textarea form__textarea",id:"review",name:"comment",placeholder:"Tell how was your stay…",value:i.comment,onChange:o,maxLength:300,disabled:a}),e.jsxs("div",{className:"reviews__button-wrapper",children:[r&&e.jsx("div",{className:"reviews__error-message",children:r}),e.jsxs("p",{className:"reviews__help",children:["To submit review please make sure to set"," ",e.jsx("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least ",e.jsx("b",{className:"reviews__text-amount",children:"50 characters"}),"."]}),e.jsx("button",{className:"reviews__submit form__submit button",type:"submit",disabled:!d||a,children:a?"Submitting...":"Submit"})]})]})}const me=({isAuth:s,reviews:t,offerId:a})=>e.jsxs("section",{className:"offer__reviews reviews",children:[e.jsx(se,{reviews:t}),s&&e.jsx(fe,{offerId:a})]}),ue=me,de=s=>s.nearby.offers,_e=Q(de,s=>s.slice(0,L)),he=s=>s.nearby.isNearbyOffersLoading,pe=s=>s.nearby.error,ve=s=>s.offer.offer,ge=s=>s.offer.isOfferLoading,xe=s=>s.offer.error,je=s=>s.offer.errorStatus;function we({isAuth:s}){const{id:t}=A(),a=k(),r=_(ve),i=_(ge),l=_(xe),d=_(je),o=_(_e),c=_(he),n=_(pe),f=_(re),m=_(ae),u=_(te);N.useEffect(()=>{t&&(a(M(t)),a(T(t)),a(I(t)))},[a,t]);const h=()=>{r&&a(B({offerId:r.id,status:r.isFavorite?0:1}))};if(i||c||m)return e.jsx(q,{});if(d===404)return e.jsx(z,{to:D.NotFound});if(l||n||u)return e.jsx(O,{});if(!r)return e.jsx(O,{});const g=`${Math.round(C(r))}%`,{host:p,images:b,goods:x}=r;return e.jsxs("div",{className:"page",children:[e.jsx($,{}),e.jsxs("main",{className:"page__main page__main--offer",children:[e.jsxs("section",{className:"offer",children:[e.jsx("div",{className:"offer__gallery-container container",children:e.jsx("div",{className:"offer__gallery",children:b.slice(0,6).map(v=>e.jsx("div",{className:"offer__image-wrapper",children:e.jsx("img",{className:"offer__image",src:v,alt:"Photo studio"})},v))})}),e.jsx("div",{className:"offer__container container",children:e.jsxs("div",{className:"offer__wrapper",children:[r.isPremium&&e.jsx("div",{className:"offer__mark",children:e.jsx("span",{children:"Premium"})}),e.jsxs("div",{className:"offer__name-wrapper",children:[e.jsx("h1",{className:"offer__name",children:r.title}),e.jsxs("button",{className:H("offer__bookmark-button button",r.isFavorite&&"offer__bookmark-button--active"),type:"button",onClick:h,children:[e.jsx("svg",{className:"offer__bookmark-icon",width:"31",height:"33",children:e.jsx("use",{xlinkHref:"#icon-bookmark"})}),e.jsx("span",{className:"visually-hidden",children:"To bookmarks"})]})]}),e.jsxs("div",{className:"offer__rating rating",children:[e.jsxs("div",{className:"offer__stars rating__stars",children:[e.jsx("span",{style:{width:g}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]}),e.jsx("span",{className:"offer__rating-value rating__value",children:r.rating})]}),e.jsxs("ul",{className:"offer__features",children:[e.jsx("li",{className:"offer__feature offer__feature--entire",children:r.type}),e.jsxs("li",{className:"offer__feature offer__feature--bedrooms",children:[r.bedrooms," Bedrooms"]}),e.jsxs("li",{className:"offer__feature offer__feature--adults",children:["Max ",r.maxAdults," adults"]})]}),e.jsxs("div",{className:"offer__price",children:[e.jsxs("b",{className:"offer__price-value",children:["€",r.price]}),e.jsx("span",{className:"offer__price-text",children:" night"})]}),e.jsxs("div",{className:"offer__inside",children:[e.jsx("h2",{className:"offer__inside-title",children:"What's inside"}),e.jsx("ul",{className:"offer__inside-list",children:x.map(v=>e.jsx("li",{className:"offer__inside-item",children:v},v))})]}),e.jsxs("div",{className:"offer__host",children:[e.jsx("h2",{className:"offer__host-title",children:"Meet the host"}),e.jsxs("div",{className:"offer__host-user user",children:[e.jsx("div",{className:`offer__avatar-wrapper ${p.isPro?"offer__avatar-wrapper--pro":""} user__avatar-wrapper`,children:e.jsx("img",{className:"offer__avatar user__avatar",src:p.avatarUrl,width:"74",height:"74",alt:"Host avatar"})}),e.jsx("span",{className:"offer__user-name",children:p.name}),p.isPro&&e.jsx("span",{className:"offer__user-status",children:"Pro"})]}),e.jsx("div",{className:"offer__description",children:e.jsx("p",{className:"offer__text",children:r.description})})]}),e.jsx(ue,{isAuth:s,reviews:f,offerId:r.id})]})}),e.jsx("section",{className:"offer__map map",children:e.jsx(U,{className:"offer__map",offers:[r,...o],activeOfferId:r.id})})]}),e.jsx(Z,{offers:o,className:"near-places__list places__list"})]})]})}export{we as default};
