import{j as e,m as A,n as R,o as F,p as P,r as E,b as k,u as f,q as L,M as T,t as M,a as z,v as D,h as I,c as q,w as $,x as H,y as U,k as B,N as W,d as C,F as G,H as X,z as Y,B as V,A as K,s as J,D as Q,E as Z}from"./index-d1b4a277.js";var S="NOT_FOUND";function ee(s){var t;return{get:function(r){return t&&s(t.key,r)?t.value:S},put:function(r,i){t={key:r,value:i}},getEntries:function(){return t?[t]:[]},clear:function(){t=void 0}}}function se(s,t){var a=[];function r(c){var o=a.findIndex(function(m){return t(c,m.key)});if(o>-1){var n=a[o];return o>0&&(a.splice(o,1),a.unshift(n)),n.value}return S}function i(c,o){r(c)===S&&(a.unshift({key:c,value:o}),a.length>s&&a.pop())}function l(){return a}function h(){a=[]}return{get:r,put:i,getEntries:l,clear:h}}var re=function(t,a){return t===a};function ae(s){return function(a,r){if(a===null||r===null||a.length!==r.length)return!1;for(var i=a.length,l=0;l<i;l++)if(!s(a[l],r[l]))return!1;return!0}}function te(s,t){var a=typeof t=="object"?t:{equalityCheck:t},r=a.equalityCheck,i=r===void 0?re:r,l=a.maxSize,h=l===void 0?1:l,c=a.resultEqualityCheck,o=ae(i),n=h===1?ee(o):se(h,o);function m(){var u=n.get(arguments);if(u===S){if(u=s.apply(null,arguments),c){var d=n.getEntries(),v=d.find(function(g){return c(g.value,u)});v&&(u=v.value)}n.put(arguments,u)}return u}return m.clearCache=function(){return n.clear()},m}function ne(s){var t=Array.isArray(s[0])?s[0]:s;if(!t.every(function(r){return typeof r=="function"})){var a=t.map(function(r){return typeof r=="function"?"function "+(r.name||"unnamed")+"()":typeof r}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+a+"]")}return t}function ie(s){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];var i=function(){for(var h=arguments.length,c=new Array(h),o=0;o<h;o++)c[o]=arguments[o];var n=0,m,u={memoizeOptions:void 0},d=c.pop();if(typeof d=="object"&&(u=d,d=c.pop()),typeof d!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof d+"]");var v=u,g=v.memoizeOptions,N=g===void 0?a:g,j=Array.isArray(N)?N:[N],x=ne(c),w=s.apply(void 0,[function(){return n++,d.apply(null,arguments)}].concat(j)),b=s(function(){for(var y=[],O=x.length,_=0;_<O;_++)y.push(x[_].apply(null,arguments));return m=w.apply(null,y),m});return Object.assign(b,{resultFunc:d,memoizedResultFunc:w,dependencies:x,lastResult:function(){return m},recomputations:function(){return n},resetRecomputations:function(){return n=0}}),b};return i}var oe=ie(te);function ce({offers:s,className:t="near-places__list places__list"}){return e.jsx("div",{className:"container",children:e.jsxs("section",{className:"near-places places",children:[e.jsx("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),e.jsx(A,{offers:s,className:t})]})})}function le({review:s}){return e.jsxs("li",{className:"reviews__item",children:[e.jsxs("div",{className:"reviews__user user",children:[e.jsx("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:e.jsx("img",{className:"reviews__avatar user__avatar",src:s.user.avatarUrl,width:"54",height:"54",alt:"Reviews avatar"})}),e.jsx("span",{className:"reviews__user-name",children:s.user.name}),s.user.isPro&&e.jsx("span",{className:"reviews__user-status",children:"Pro"})]}),e.jsxs("div",{className:"reviews__info",children:[e.jsx("div",{className:"reviews__rating rating",children:e.jsxs("div",{className:"reviews__stars rating__stars",children:[e.jsx("span",{style:{width:`${R({rating:s.rating})}%`}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]})}),e.jsx("p",{className:"reviews__text",children:s.comment}),e.jsx("time",{className:"reviews__time",dateTime:F(s.date),children:P(s.date)})]})]},s.id)}const fe=10,me=({reviews:s})=>{const a=[...s].sort((r,i)=>new Date(i.date).getTime()-new Date(r.date).getTime()).slice(0,fe);return e.jsxs(E.Fragment,{children:[e.jsxs("h2",{className:"reviews__title",children:["Reviews · ",e.jsx("span",{className:"reviews__amount",children:s.length})]}),e.jsx("ul",{className:"reviews__list",children:a.map(r=>e.jsx(le,{review:r},r.id))})]})},ue=s=>s.comments.comments,de=s=>s.comments.isCommentsLoading,_e=s=>s.comments.error,he=s=>s.comments.isPosting,pe=s=>s.comments.postError,ve=[{value:5,title:"perfect"},{value:4,title:"good"},{value:3,title:"not bad"},{value:2,title:"badly"},{value:1,title:"terribly"}],ge=50,xe=300;function Ne({offerId:s}){const t=k(),a=f(he),r=f(pe),[i,l]=E.useState({rating:0,comment:""}),h=i.rating>0&&i.comment.trim().length>=ge&&i.comment.trim().length<=xe,c=n=>{const m=n.target,{name:u,value:d}=m;l(v=>({...v,[u]:u==="rating"?Number(d):d}))},o=()=>{!h||a||t(L({offerId:s,comment:i.comment.trim(),rating:i.rating})).unwrap().then(()=>{l({rating:0,comment:""})}).catch(()=>{})};return e.jsxs("form",{className:"reviews__form form",onSubmit:n=>{n.preventDefault(),o()},children:[e.jsx("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),e.jsx("div",{className:"reviews__rating-form form__rating",children:ve.map(({value:n,title:m})=>e.jsxs(E.Fragment,{children:[e.jsx("input",{className:"form__rating-input visually-hidden",name:"rating",value:n,id:`${n}-stars`,type:"radio",checked:i.rating===n,onChange:c,disabled:a}),e.jsx("label",{htmlFor:`${n}-stars`,className:"reviews__rating-label form__rating-label",title:m,children:e.jsx("svg",{className:"form__star-image",width:"37",height:"33",children:e.jsx("use",{xlinkHref:"#icon-star"})})})]},n))}),e.jsx("textarea",{className:"reviews__textarea form__textarea",id:"review",name:"comment",placeholder:"Tell how was your stay…",value:i.comment,onChange:c,maxLength:300,disabled:a}),e.jsxs("div",{className:"reviews__button-wrapper",children:[r&&e.jsx("div",{className:"reviews__error-message",children:r}),e.jsxs("p",{className:"reviews__help",children:["To submit review please make sure to set"," ",e.jsx("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least ",e.jsx("b",{className:"reviews__text-amount",children:"50 characters"}),"."]}),e.jsx("button",{className:"reviews__submit form__submit button",type:"submit",disabled:!h||a,children:a?"Submitting...":"Submit"})]})]})}const je=({isAuth:s,reviews:t,offerId:a})=>e.jsxs("section",{className:"offer__reviews reviews",children:[e.jsx(me,{reviews:t}),s&&e.jsx(Ne,{offerId:a})]}),we=je,be=s=>s.nearby.offers,ye=oe(be,s=>s.slice(0,T)),Ee=s=>s.nearby.isNearbyOffersLoading,Se=s=>s.nearby.error,Oe=s=>s.offer.offer,Ce=s=>s.offer.isOfferLoading,Re=s=>s.offer.error,ke=s=>s.offer.errorStatus;function Fe({isAuth:s}){const{id:t}=M(),a=k(),r=f(Oe),i=f(z),l=f(Ce),h=f(Re),c=f(ke),o=f(ye),n=f(Ee),m=f(Se),u=f(ue),d=f(de),v=f(_e),g=f(D),j=f(I).some(_=>_.id===t),x=q();E.useEffect(()=>{t&&(a($(t)),a(H(t)),a(U(t)))},[a,t]);const w=()=>{if(r){if(i!==K.Auth){a(J("You need to log in to add to favorites")),a(Q()),x(C.Login);return}const _=j?0:1;a(Z({offerId:r.id,status:_}))}};if(l||n||d)return e.jsx(B,{});if(c===404)return e.jsx(W,{to:C.NotFound});if(h||m||v||!r)return e.jsx(G,{});const b=`${R(r)}%`,{host:p,images:y,goods:O}=r;return e.jsxs("div",{className:"page",children:[e.jsx(X,{}),e.jsxs("main",{className:"page__main page__main--offer",children:[e.jsxs("section",{className:"offer",children:[e.jsx("div",{className:"offer__gallery-container container",children:e.jsx("div",{className:"offer__gallery",children:y.slice(0,6).map(_=>e.jsx("div",{className:"offer__image-wrapper",children:e.jsx("img",{className:"offer__image",src:_,alt:"Photo studio"})},_))})}),e.jsx("div",{className:"offer__container container",children:e.jsxs("div",{className:"offer__wrapper",children:[r.isPremium&&e.jsx("div",{className:"offer__mark",children:e.jsx("span",{children:"Premium"})}),e.jsxs("div",{className:"offer__name-wrapper",children:[e.jsx("h1",{className:"offer__name",children:r.title}),e.jsxs("button",{className:Y("offer__bookmark-button",{"offer__bookmark-button--active":j},"button"),type:"button",onClick:w,disabled:g,children:[e.jsx("svg",{className:"offer__bookmark-icon",width:"31",height:"33",children:e.jsx("use",{xlinkHref:"#icon-bookmark"})}),e.jsx("span",{className:"visually-hidden",children:"To bookmarks"})]})]}),e.jsxs("div",{className:"offer__rating rating",children:[e.jsxs("div",{className:"offer__stars rating__stars",children:[e.jsx("span",{style:{width:b}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]}),e.jsx("span",{className:"offer__rating-value rating__value",children:r.rating})]}),e.jsxs("ul",{className:"offer__features",children:[e.jsx("li",{className:"offer__feature offer__feature--entire",children:r.type}),e.jsxs("li",{className:"offer__feature offer__feature--bedrooms",children:[r.bedrooms," Bedrooms"]}),e.jsxs("li",{className:"offer__feature offer__feature--adults",children:["Max ",r.maxAdults," adults"]})]}),e.jsxs("div",{className:"offer__price",children:[e.jsxs("b",{className:"offer__price-value",children:["€",r.price]}),e.jsx("span",{className:"offer__price-text",children:" night"})]}),e.jsxs("div",{className:"offer__inside",children:[e.jsx("h2",{className:"offer__inside-title",children:"What's inside"}),e.jsx("ul",{className:"offer__inside-list",children:O.map(_=>e.jsx("li",{className:"offer__inside-item",children:_},_))})]}),e.jsxs("div",{className:"offer__host",children:[e.jsx("h2",{className:"offer__host-title",children:"Meet the host"}),e.jsxs("div",{className:"offer__host-user user",children:[e.jsx("div",{className:`offer__avatar-wrapper ${p.isPro?"offer__avatar-wrapper--pro":""} user__avatar-wrapper`,children:e.jsx("img",{className:"offer__avatar user__avatar",src:p.avatarUrl,width:"74",height:"74",alt:"Host avatar"})}),e.jsx("span",{className:"offer__user-name",children:p.name}),p.isPro&&e.jsx("span",{className:"offer__user-status",children:"Pro"})]}),e.jsx("div",{className:"offer__description",children:e.jsx("p",{className:"offer__text",children:r.description})})]}),e.jsx(we,{isAuth:s,reviews:u,offerId:r.id})]})}),e.jsx("section",{className:"offer__map map",children:e.jsx(V,{className:"offer__map",offers:[r,...o],activeOfferId:r.id})})]}),e.jsx(ce,{offers:o,className:"near-places__list places__list"})]})]})}export{Fe as default};
