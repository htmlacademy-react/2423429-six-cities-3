import{j as e,m as k,n as C,r as E,b as R,u as f,p as A,M as F,o as P,a as L,q as M,h as z,t as T,v as I,w as q,k as D,N as $,d as H,F as U,H as B,x as W,y as G,A as X,s as Y,z as V,B as K}from"./index-dd2a9492.js";var S="NOT_FOUND";function J(s){var t;return{get:function(a){return t&&s(t.key,a)?t.value:S},put:function(a,i){t={key:a,value:i}},getEntries:function(){return t?[t]:[]},clear:function(){t=void 0}}}function Q(s,t){var r=[];function a(c){var o=r.findIndex(function(u){return t(c,u.key)});if(o>-1){var n=r[o];return o>0&&(r.splice(o,1),r.unshift(n)),n.value}return S}function i(c,o){a(c)===S&&(r.unshift({key:c,value:o}),r.length>s&&r.pop())}function l(){return r}function _(){r=[]}return{get:a,put:i,getEntries:l,clear:_}}var Z=function(t,r){return t===r};function ee(s){return function(r,a){if(r===null||a===null||r.length!==a.length)return!1;for(var i=r.length,l=0;l<i;l++)if(!s(r[l],a[l]))return!1;return!0}}function se(s,t){var r=typeof t=="object"?t:{equalityCheck:t},a=r.equalityCheck,i=a===void 0?Z:a,l=r.maxSize,_=l===void 0?1:l,c=r.resultEqualityCheck,o=ee(i),n=_===1?J(o):Q(_,o);function u(){var m=n.get(arguments);if(m===S){if(m=s.apply(null,arguments),c){var d=n.getEntries(),p=d.find(function(g){return c(g.value,m)});p&&(m=p.value)}n.put(arguments,m)}return m}return u.clearCache=function(){return n.clear()},u}function re(s){var t=Array.isArray(s[0])?s[0]:s;if(!t.every(function(a){return typeof a=="function"})){var r=t.map(function(a){return typeof a=="function"?"function "+(a.name||"unnamed")+"()":typeof a}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+r+"]")}return t}function ae(s){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];var i=function(){for(var _=arguments.length,c=new Array(_),o=0;o<_;o++)c[o]=arguments[o];var n=0,u,m={memoizeOptions:void 0},d=c.pop();if(typeof d=="object"&&(m=d,d=c.pop()),typeof d!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof d+"]");var p=m,g=p.memoizeOptions,j=g===void 0?r:g,w=Array.isArray(j)?j:[j],N=re(c),b=s.apply(void 0,[function(){return n++,d.apply(null,arguments)}].concat(w)),v=s(function(){for(var y=[],h=N.length,O=0;O<h;O++)y.push(N[O].apply(null,arguments));return u=b.apply(null,y),u});return Object.assign(v,{resultFunc:d,memoizedResultFunc:b,dependencies:N,lastResult:function(){return u},recomputations:function(){return n},resetRecomputations:function(){return n=0}}),v};return i}var te=ae(se);function ne({offers:s,className:t="near-places__list places__list"}){return e.jsx("div",{className:"container",children:e.jsxs("section",{className:"near-places places",children:[e.jsx("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),e.jsx(k,{offers:s,className:t})]})})}function ie({review:s}){const t=new Date(s.date);return e.jsxs("li",{className:"reviews__item",children:[e.jsxs("div",{className:"reviews__user user",children:[e.jsx("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:e.jsx("img",{className:"reviews__avatar user__avatar",src:s.user.avatarUrl,width:"54",height:"54",alt:"Reviews avatar"})}),e.jsx("span",{className:"reviews__user-name",children:s.user.name}),s.user.isPro&&e.jsx("span",{className:"reviews__user-status",children:"Pro"})]}),e.jsxs("div",{className:"reviews__info",children:[e.jsx("div",{className:"reviews__rating rating",children:e.jsxs("div",{className:"reviews__stars rating__stars",children:[e.jsx("span",{style:{width:`${C({rating:s.rating})}%`}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]})}),e.jsx("p",{className:"reviews__text",children:s.comment}),e.jsx("time",{className:"reviews__time",dateTime:t.toISOString().slice(0,10),children:t.toLocaleString("default",{month:"long",year:"numeric"})})]})]},s.id)}const oe=10,ce=({reviews:s})=>{const t=s.slice(0,oe);return e.jsxs(E.Fragment,{children:[e.jsxs("h2",{className:"reviews__title",children:["Reviews · ",e.jsx("span",{className:"reviews__amount",children:s.length})]}),e.jsx("ul",{className:"reviews__list",children:t.map(r=>e.jsx(ie,{review:r},r.id))})]})},le=s=>s.comments.comments,fe=s=>s.comments.isCommentsLoading,ue=s=>s.comments.error,me=s=>s.comments.isPosting,de=s=>s.comments.postError,_e=[{value:5,title:"perfect"},{value:4,title:"good"},{value:3,title:"not bad"},{value:2,title:"badly"},{value:1,title:"terribly"}],he=50,pe=300;function ve({offerId:s}){const t=R(),r=f(me),a=f(de),[i,l]=E.useState({rating:0,comment:""}),_=i.rating>0&&i.comment.trim().length>=he&&i.comment.trim().length<=pe,c=n=>{const u=n.target,{name:m,value:d}=u;l(p=>({...p,[m]:m==="rating"?Number(d):d}))},o=()=>{!_||r||t(A({offerId:s,comment:i.comment.trim(),rating:i.rating})).unwrap().then(()=>{l({rating:0,comment:""})})};return e.jsxs("form",{className:"reviews__form form",onSubmit:n=>{n.preventDefault(),o()},children:[e.jsx("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),e.jsx("div",{className:"reviews__rating-form form__rating",children:_e.map(({value:n,title:u})=>e.jsxs(E.Fragment,{children:[e.jsx("input",{className:"form__rating-input visually-hidden",name:"rating",value:n,id:`${n}-stars`,type:"radio",checked:i.rating===n,onChange:c,disabled:r}),e.jsx("label",{htmlFor:`${n}-stars`,className:"reviews__rating-label form__rating-label",title:u,children:e.jsx("svg",{className:"form__star-image",width:"37",height:"33",children:e.jsx("use",{xlinkHref:"#icon-star"})})})]},n))}),e.jsx("textarea",{className:"reviews__textarea form__textarea",id:"review",name:"comment",placeholder:"Tell how was your stay…",value:i.comment,onChange:c,maxLength:300,disabled:r}),e.jsxs("div",{className:"reviews__button-wrapper",children:[a&&e.jsx("div",{className:"reviews__error-message",children:a}),e.jsxs("p",{className:"reviews__help",children:["To submit review please make sure to set"," ",e.jsx("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least ",e.jsx("b",{className:"reviews__text-amount",children:"50 characters"}),"."]}),e.jsx("button",{className:"reviews__submit form__submit button",type:"submit",disabled:!_||r,children:r?"Submitting...":"Submit"})]})]})}const ge=({isAuth:s,reviews:t,offerId:r})=>e.jsxs("section",{className:"offer__reviews reviews",children:[e.jsx(ce,{reviews:t}),s&&e.jsx(ve,{offerId:r})]}),xe=ge,Ne=s=>s.nearby.offers,je=te(Ne,s=>s.slice(0,F)),we=s=>s.nearby.isNearbyOffersLoading,be=s=>s.nearby.error,ye=s=>s.offer.offer,Ee=s=>s.offer.isOfferLoading,Se=s=>s.offer.error,Oe=s=>s.offer.errorStatus;function Re({isAuth:s}){const{id:t}=P(),r=R(),a=f(ye),i=f(L),l=f(Ee),_=f(Se),c=f(Oe),o=f(je),n=f(we),u=f(be),m=f(le),d=f(fe),p=f(ue),g=f(M),w=f(z).some(h=>h.id===t);E.useEffect(()=>{t&&(r(T(t)),r(I(t)),r(q(t)))},[r,t]);const N=()=>{if(a){if(i!==X.Auth){r(Y("You need to log in to add to favorites")),r(V());return}const h=w?0:1;r(K({offerId:a.id,status:h}))}};if(l||n||d)return e.jsx(D,{});if(c===404)return e.jsx($,{to:H.NotFound});if(_||u||p||!a)return e.jsx(U,{});const b=`${Math.round(C(a))}%`,{host:v,images:x,goods:y}=a;return e.jsxs("div",{className:"page",children:[e.jsx(B,{}),e.jsxs("main",{className:"page__main page__main--offer",children:[e.jsxs("section",{className:"offer",children:[e.jsx("div",{className:"offer__gallery-container container",children:e.jsx("div",{className:"offer__gallery",children:x.slice(0,6).map(h=>e.jsx("div",{className:"offer__image-wrapper",children:e.jsx("img",{className:"offer__image",src:h,alt:"Photo studio"})},h))})}),e.jsx("div",{className:"offer__container container",children:e.jsxs("div",{className:"offer__wrapper",children:[a.isPremium&&e.jsx("div",{className:"offer__mark",children:e.jsx("span",{children:"Premium"})}),e.jsxs("div",{className:"offer__name-wrapper",children:[e.jsx("h1",{className:"offer__name",children:a.title}),e.jsxs("button",{className:W("offer__bookmark-button button",w&&"offer__bookmark-button--active"),type:"button",onClick:N,disabled:g,children:[e.jsx("svg",{className:"offer__bookmark-icon",width:"31",height:"33",children:e.jsx("use",{xlinkHref:"#icon-bookmark"})}),e.jsx("span",{className:"visually-hidden",children:"To bookmarks"})]})]}),e.jsxs("div",{className:"offer__rating rating",children:[e.jsxs("div",{className:"offer__stars rating__stars",children:[e.jsx("span",{style:{width:b}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]}),e.jsx("span",{className:"offer__rating-value rating__value",children:a.rating})]}),e.jsxs("ul",{className:"offer__features",children:[e.jsx("li",{className:"offer__feature offer__feature--entire",children:a.type}),e.jsxs("li",{className:"offer__feature offer__feature--bedrooms",children:[a.bedrooms," Bedrooms"]}),e.jsxs("li",{className:"offer__feature offer__feature--adults",children:["Max ",a.maxAdults," adults"]})]}),e.jsxs("div",{className:"offer__price",children:[e.jsxs("b",{className:"offer__price-value",children:["€",a.price]}),e.jsx("span",{className:"offer__price-text",children:" night"})]}),e.jsxs("div",{className:"offer__inside",children:[e.jsx("h2",{className:"offer__inside-title",children:"What's inside"}),e.jsx("ul",{className:"offer__inside-list",children:y.map(h=>e.jsx("li",{className:"offer__inside-item",children:h},h))})]}),e.jsxs("div",{className:"offer__host",children:[e.jsx("h2",{className:"offer__host-title",children:"Meet the host"}),e.jsxs("div",{className:"offer__host-user user",children:[e.jsx("div",{className:`offer__avatar-wrapper ${v.isPro?"offer__avatar-wrapper--pro":""} user__avatar-wrapper`,children:e.jsx("img",{className:"offer__avatar user__avatar",src:v.avatarUrl,width:"74",height:"74",alt:"Host avatar"})}),e.jsx("span",{className:"offer__user-name",children:v.name}),v.isPro&&e.jsx("span",{className:"offer__user-status",children:"Pro"})]}),e.jsx("div",{className:"offer__description",children:e.jsx("p",{className:"offer__text",children:a.description})})]}),e.jsx(xe,{isAuth:s,reviews:m,offerId:a.id})]})}),e.jsx("section",{className:"offer__map map",children:e.jsx(G,{className:"offer__map",offers:[a,...o],activeOfferId:a.id})})]}),e.jsx(ne,{offers:o,className:"near-places__list places__list"})]})]})}export{Re as default};
