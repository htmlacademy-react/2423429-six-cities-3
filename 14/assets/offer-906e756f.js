import{j as e,k as F,m as C,r as b,b as k,u as d,p as P,M as L,n as A,o as M,f as T,q as I,t as q,v as z,i as D,N as $,d as H,F as O,H as U,w as B,x as G,y as W}from"./index-e798c407.js";var y="NOT_FOUND";function X(s){var a;return{get:function(r){return a&&s(a.key,r)?a.value:y},put:function(r,i){a={key:r,value:i}},getEntries:function(){return a?[a]:[]},clear:function(){a=void 0}}}function Y(s,a){var t=[];function r(o){var c=t.findIndex(function(f){return a(o,f.key)});if(c>-1){var n=t[c];return c>0&&(t.splice(c,1),t.unshift(n)),n.value}return y}function i(o,c){r(o)===y&&(t.unshift({key:o,value:c}),t.length>s&&t.pop())}function l(){return t}function _(){t=[]}return{get:r,put:i,getEntries:l,clear:_}}var K=function(a,t){return a===t};function V(s){return function(t,r){if(t===null||r===null||t.length!==r.length)return!1;for(var i=t.length,l=0;l<i;l++)if(!s(t[l],r[l]))return!1;return!0}}function J(s,a){var t=typeof a=="object"?a:{equalityCheck:a},r=t.equalityCheck,i=r===void 0?K:r,l=t.maxSize,_=l===void 0?1:l,o=t.resultEqualityCheck,c=V(i),n=_===1?X(c):Y(_,c);function f(){var m=n.get(arguments);if(m===y){if(m=s.apply(null,arguments),o){var u=n.getEntries(),p=u.find(function(j){return o(j.value,m)});p&&(m=p.value)}n.put(arguments,m)}return m}return f.clearCache=function(){return n.clear()},f}function Q(s){var a=Array.isArray(s[0])?s[0]:s;if(!a.every(function(r){return typeof r=="function"})){var t=a.map(function(r){return typeof r=="function"?"function "+(r.name||"unnamed")+"()":typeof r}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+t+"]")}return a}function Z(s){for(var a=arguments.length,t=new Array(a>1?a-1:0),r=1;r<a;r++)t[r-1]=arguments[r];var i=function(){for(var _=arguments.length,o=new Array(_),c=0;c<_;c++)o[c]=arguments[c];var n=0,f,m={memoizeOptions:void 0},u=o.pop();if(typeof u=="object"&&(m=u,u=o.pop()),typeof u!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof u+"]");var p=m,j=p.memoizeOptions,g=j===void 0?t:j,E=Array.isArray(g)?g:[g],N=Q(o),v=s.apply(void 0,[function(){return n++,u.apply(null,arguments)}].concat(E)),w=s(function(){for(var h=[],R=N.length,S=0;S<R;S++)h.push(N[S].apply(null,arguments));return f=v.apply(null,h),f});return Object.assign(w,{resultFunc:u,memoizedResultFunc:v,dependencies:N,lastResult:function(){return f},recomputations:function(){return n},resetRecomputations:function(){return n=0}}),w};return i}var ee=Z(J);function se({offers:s,className:a="near-places__list places__list"}){return e.jsx("div",{className:"container",children:e.jsxs("section",{className:"near-places places",children:[e.jsx("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),e.jsx(F,{offers:s,className:a})]})})}function re({review:s}){const a=new Date(s.date);return e.jsxs("li",{className:"reviews__item",children:[e.jsxs("div",{className:"reviews__user user",children:[e.jsx("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:e.jsx("img",{className:"reviews__avatar user__avatar",src:s.user.avatarUrl,width:"54",height:"54",alt:"Reviews avatar"})}),e.jsx("span",{className:"reviews__user-name",children:s.user.name}),s.user.isPro&&e.jsx("span",{className:"reviews__user-status",children:"Pro"})]}),e.jsxs("div",{className:"reviews__info",children:[e.jsx("div",{className:"reviews__rating rating",children:e.jsxs("div",{className:"reviews__stars rating__stars",children:[e.jsx("span",{style:{width:`${C({rating:s.rating})}%`}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]})}),e.jsx("p",{className:"reviews__text",children:s.comment}),e.jsx("time",{className:"reviews__time",dateTime:a.toISOString().slice(0,10),children:a.toLocaleString("default",{month:"long",year:"numeric"})})]})]},s.id)}const ae=({reviews:s})=>e.jsxs(b.Fragment,{children:[e.jsxs("h2",{className:"reviews__title",children:["Reviews · ",e.jsx("span",{className:"reviews__amount",children:s.length})]}),e.jsx("ul",{className:"reviews__list",children:s.map(a=>e.jsx(re,{review:a},a.id))})]}),te=s=>s.comments.comments,ne=s=>s.comments.isCommentsLoading,ie=s=>s.comments.error,oe=s=>s.comments.isPosting,ce=s=>s.comments.postError,le=[{value:5,title:"perfect"},{value:4,title:"good"},{value:3,title:"not bad"},{value:2,title:"badly"},{value:1,title:"terribly"}],fe=50,me=300;function ue({offerId:s}){const a=k(),t=d(oe),r=d(ce),[i,l]=b.useState({rating:0,comment:""}),_=i.rating>0&&i.comment.trim().length>=fe&&i.comment.trim().length<=me,o=n=>{const f=n.target,{name:m,value:u}=f;l(p=>({...p,[m]:m==="rating"?Number(u):u}))},c=()=>{!_||t||a(P({offerId:s,comment:i.comment.trim(),rating:i.rating})).unwrap().then(()=>{l({rating:0,comment:""})})};return e.jsxs("form",{className:"reviews__form form",onSubmit:n=>{n.preventDefault(),c()},children:[e.jsx("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),e.jsx("div",{className:"reviews__rating-form form__rating",children:le.map(({value:n,title:f})=>e.jsxs(b.Fragment,{children:[e.jsx("input",{className:"form__rating-input visually-hidden",name:"rating",value:n,id:`${n}-stars`,type:"radio",checked:i.rating===n,onChange:o,disabled:t}),e.jsx("label",{htmlFor:`${n}-stars`,className:"reviews__rating-label form__rating-label",title:f,children:e.jsx("svg",{className:"form__star-image",width:"37",height:"33",children:e.jsx("use",{xlinkHref:"#icon-star"})})})]},n))}),e.jsx("textarea",{className:"reviews__textarea form__textarea",id:"review",name:"comment",placeholder:"Tell how was your stay…",value:i.comment,onChange:o,maxLength:300,disabled:t}),e.jsxs("div",{className:"reviews__button-wrapper",children:[r&&e.jsx("div",{className:"reviews__error-message",children:r}),e.jsxs("p",{className:"reviews__help",children:["To submit review please make sure to set"," ",e.jsx("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least ",e.jsx("b",{className:"reviews__text-amount",children:"50 characters"}),"."]}),e.jsx("button",{className:"reviews__submit form__submit button",type:"submit",disabled:!_||t,children:t?"Submitting...":"Submit"})]})]})}const de=({isAuth:s,reviews:a,offerId:t})=>e.jsxs("section",{className:"offer__reviews reviews",children:[e.jsx(ae,{reviews:a}),s&&e.jsx(ue,{offerId:t})]}),_e=de,he=s=>s.nearby.offers,pe=ee(he,s=>s.slice(0,L)),ve=s=>s.nearby.isNearbyOffersLoading,ge=s=>s.nearby.error,xe=s=>s.offer.offer,je=s=>s.offer.isOfferLoading,Ne=s=>s.offer.error,we=s=>s.offer.errorStatus;function ye({isAuth:s}){const{id:a}=A(),t=k(),r=d(xe),i=d(je),l=d(Ne),_=d(we),o=d(pe),c=d(ve),n=d(ge),f=d(te),m=d(ne),u=d(ie),p=d(M),g=d(T).some(h=>h.id===a);b.useEffect(()=>{a&&(t(I(a)),t(q(a)),t(z(a)))},[t,a]);const E=()=>{r&&t(W({offerId:r.id,status:g?0:1}))};if(i||c||m)return e.jsx(D,{});if(_===404)return e.jsx($,{to:H.NotFound});if(l||n||u)return e.jsx(O,{});if(!r)return e.jsx(O,{});const N=`${Math.round(C(r))}%`,{host:v,images:w,goods:x}=r;return e.jsxs("div",{className:"page",children:[e.jsx(U,{}),e.jsxs("main",{className:"page__main page__main--offer",children:[e.jsxs("section",{className:"offer",children:[e.jsx("div",{className:"offer__gallery-container container",children:e.jsx("div",{className:"offer__gallery",children:w.slice(0,6).map(h=>e.jsx("div",{className:"offer__image-wrapper",children:e.jsx("img",{className:"offer__image",src:h,alt:"Photo studio"})},h))})}),e.jsx("div",{className:"offer__container container",children:e.jsxs("div",{className:"offer__wrapper",children:[r.isPremium&&e.jsx("div",{className:"offer__mark",children:e.jsx("span",{children:"Premium"})}),e.jsxs("div",{className:"offer__name-wrapper",children:[e.jsx("h1",{className:"offer__name",children:r.title}),e.jsxs("button",{className:B("offer__bookmark-button button",g&&"offer__bookmark-button--active"),type:"button",onClick:E,disabled:p,children:[e.jsx("svg",{className:"offer__bookmark-icon",width:"31",height:"33",children:e.jsx("use",{xlinkHref:"#icon-bookmark"})}),e.jsx("span",{className:"visually-hidden",children:"To bookmarks"})]})]}),e.jsxs("div",{className:"offer__rating rating",children:[e.jsxs("div",{className:"offer__stars rating__stars",children:[e.jsx("span",{style:{width:N}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]}),e.jsx("span",{className:"offer__rating-value rating__value",children:r.rating})]}),e.jsxs("ul",{className:"offer__features",children:[e.jsx("li",{className:"offer__feature offer__feature--entire",children:r.type}),e.jsxs("li",{className:"offer__feature offer__feature--bedrooms",children:[r.bedrooms," Bedrooms"]}),e.jsxs("li",{className:"offer__feature offer__feature--adults",children:["Max ",r.maxAdults," adults"]})]}),e.jsxs("div",{className:"offer__price",children:[e.jsxs("b",{className:"offer__price-value",children:["€",r.price]}),e.jsx("span",{className:"offer__price-text",children:" night"})]}),e.jsxs("div",{className:"offer__inside",children:[e.jsx("h2",{className:"offer__inside-title",children:"What's inside"}),e.jsx("ul",{className:"offer__inside-list",children:x.map(h=>e.jsx("li",{className:"offer__inside-item",children:h},h))})]}),e.jsxs("div",{className:"offer__host",children:[e.jsx("h2",{className:"offer__host-title",children:"Meet the host"}),e.jsxs("div",{className:"offer__host-user user",children:[e.jsx("div",{className:`offer__avatar-wrapper ${v.isPro?"offer__avatar-wrapper--pro":""} user__avatar-wrapper`,children:e.jsx("img",{className:"offer__avatar user__avatar",src:v.avatarUrl,width:"74",height:"74",alt:"Host avatar"})}),e.jsx("span",{className:"offer__user-name",children:v.name}),v.isPro&&e.jsx("span",{className:"offer__user-status",children:"Pro"})]}),e.jsx("div",{className:"offer__description",children:e.jsx("p",{className:"offer__text",children:r.description})})]}),e.jsx(_e,{isAuth:s,reviews:f,offerId:r.id})]})}),e.jsx("section",{className:"offer__map map",children:e.jsx(G,{className:"offer__map",offers:[r,...o],activeOfferId:r.id})})]}),e.jsx(se,{offers:o,className:"near-places__list places__list"})]})]})}export{ye as default};
