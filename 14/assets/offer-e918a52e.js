import{j as e,m as k,n as C,o as A,p as F,r as E,b as R,u as f,q as P,M as L,t as M,a as T,v as z,h as D,w as I,x as q,y as $,k as H,N as U,d as B,F as W,H as G,z as X,B as Y,A as V,s as K,D as J,E as Q}from"./index-905645be.js";var S="NOT_FOUND";function Z(s){var t;return{get:function(r){return t&&s(t.key,r)?t.value:S},put:function(r,i){t={key:r,value:i}},getEntries:function(){return t?[t]:[]},clear:function(){t=void 0}}}function ee(s,t){var a=[];function r(c){var o=a.findIndex(function(m){return t(c,m.key)});if(o>-1){var n=a[o];return o>0&&(a.splice(o,1),a.unshift(n)),n.value}return S}function i(c,o){r(c)===S&&(a.unshift({key:c,value:o}),a.length>s&&a.pop())}function l(){return a}function _(){a=[]}return{get:r,put:i,getEntries:l,clear:_}}var se=function(t,a){return t===a};function re(s){return function(a,r){if(a===null||r===null||a.length!==r.length)return!1;for(var i=a.length,l=0;l<i;l++)if(!s(a[l],r[l]))return!1;return!0}}function ae(s,t){var a=typeof t=="object"?t:{equalityCheck:t},r=a.equalityCheck,i=r===void 0?se:r,l=a.maxSize,_=l===void 0?1:l,c=a.resultEqualityCheck,o=re(i),n=_===1?Z(o):ee(_,o);function m(){var u=n.get(arguments);if(u===S){if(u=s.apply(null,arguments),c){var d=n.getEntries(),p=d.find(function(g){return c(g.value,u)});p&&(u=p.value)}n.put(arguments,u)}return u}return m.clearCache=function(){return n.clear()},m}function te(s){var t=Array.isArray(s[0])?s[0]:s;if(!t.every(function(r){return typeof r=="function"})){var a=t.map(function(r){return typeof r=="function"?"function "+(r.name||"unnamed")+"()":typeof r}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+a+"]")}return t}function ne(s){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];var i=function(){for(var _=arguments.length,c=new Array(_),o=0;o<_;o++)c[o]=arguments[o];var n=0,m,u={memoizeOptions:void 0},d=c.pop();if(typeof d=="object"&&(u=d,d=c.pop()),typeof d!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof d+"]");var p=u,g=p.memoizeOptions,j=g===void 0?a:g,w=Array.isArray(j)?j:[j],N=te(c),b=s.apply(void 0,[function(){return n++,d.apply(null,arguments)}].concat(w)),v=s(function(){for(var y=[],h=N.length,O=0;O<h;O++)y.push(N[O].apply(null,arguments));return m=b.apply(null,y),m});return Object.assign(v,{resultFunc:d,memoizedResultFunc:b,dependencies:N,lastResult:function(){return m},recomputations:function(){return n},resetRecomputations:function(){return n=0}}),v};return i}var ie=ne(ae);function oe({offers:s,className:t="near-places__list places__list"}){return e.jsx("div",{className:"container",children:e.jsxs("section",{className:"near-places places",children:[e.jsx("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),e.jsx(k,{offers:s,className:t})]})})}function ce({review:s}){return e.jsxs("li",{className:"reviews__item",children:[e.jsxs("div",{className:"reviews__user user",children:[e.jsx("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:e.jsx("img",{className:"reviews__avatar user__avatar",src:s.user.avatarUrl,width:"54",height:"54",alt:"Reviews avatar"})}),e.jsx("span",{className:"reviews__user-name",children:s.user.name}),s.user.isPro&&e.jsx("span",{className:"reviews__user-status",children:"Pro"})]}),e.jsxs("div",{className:"reviews__info",children:[e.jsx("div",{className:"reviews__rating rating",children:e.jsxs("div",{className:"reviews__stars rating__stars",children:[e.jsx("span",{style:{width:`${C({rating:s.rating})}%`}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]})}),e.jsx("p",{className:"reviews__text",children:s.comment}),e.jsx("time",{className:"reviews__time",dateTime:A(s.date),children:F(s.date)})]})]},s.id)}const le=10,fe=({reviews:s})=>{const a=[...s].sort((r,i)=>new Date(i.date).getTime()-new Date(r.date).getTime()).slice(0,le);return e.jsxs(E.Fragment,{children:[e.jsxs("h2",{className:"reviews__title",children:["Reviews · ",e.jsx("span",{className:"reviews__amount",children:s.length})]}),e.jsx("ul",{className:"reviews__list",children:a.map(r=>e.jsx(ce,{review:r},r.id))})]})},me=s=>s.comments.comments,ue=s=>s.comments.isCommentsLoading,de=s=>s.comments.error,_e=s=>s.comments.isPosting,he=s=>s.comments.postError,pe=[{value:5,title:"perfect"},{value:4,title:"good"},{value:3,title:"not bad"},{value:2,title:"badly"},{value:1,title:"terribly"}],ve=50,ge=300;function xe({offerId:s}){const t=R(),a=f(_e),r=f(he),[i,l]=E.useState({rating:0,comment:""}),_=i.rating>0&&i.comment.trim().length>=ve&&i.comment.trim().length<=ge,c=n=>{const m=n.target,{name:u,value:d}=m;l(p=>({...p,[u]:u==="rating"?Number(d):d}))},o=()=>{!_||a||t(P({offerId:s,comment:i.comment.trim(),rating:i.rating})).unwrap().then(()=>{l({rating:0,comment:""})}).catch(()=>{})};return e.jsxs("form",{className:"reviews__form form",onSubmit:n=>{n.preventDefault(),o()},children:[e.jsx("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),e.jsx("div",{className:"reviews__rating-form form__rating",children:pe.map(({value:n,title:m})=>e.jsxs(E.Fragment,{children:[e.jsx("input",{className:"form__rating-input visually-hidden",name:"rating",value:n,id:`${n}-stars`,type:"radio",checked:i.rating===n,onChange:c,disabled:a}),e.jsx("label",{htmlFor:`${n}-stars`,className:"reviews__rating-label form__rating-label",title:m,children:e.jsx("svg",{className:"form__star-image",width:"37",height:"33",children:e.jsx("use",{xlinkHref:"#icon-star"})})})]},n))}),e.jsx("textarea",{className:"reviews__textarea form__textarea",id:"review",name:"comment",placeholder:"Tell how was your stay…",value:i.comment,onChange:c,maxLength:300,disabled:a}),e.jsxs("div",{className:"reviews__button-wrapper",children:[r&&e.jsx("div",{className:"reviews__error-message",children:r}),e.jsxs("p",{className:"reviews__help",children:["To submit review please make sure to set"," ",e.jsx("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least ",e.jsx("b",{className:"reviews__text-amount",children:"50 characters"}),"."]}),e.jsx("button",{className:"reviews__submit form__submit button",type:"submit",disabled:!_||a,children:a?"Submitting...":"Submit"})]})]})}const Ne=({isAuth:s,reviews:t,offerId:a})=>e.jsxs("section",{className:"offer__reviews reviews",children:[e.jsx(fe,{reviews:t}),s&&e.jsx(xe,{offerId:a})]}),je=Ne,we=s=>s.nearby.offers,be=ie(we,s=>s.slice(0,L)),ye=s=>s.nearby.isNearbyOffersLoading,Ee=s=>s.nearby.error,Se=s=>s.offer.offer,Oe=s=>s.offer.isOfferLoading,Ce=s=>s.offer.error,Re=s=>s.offer.errorStatus;function Ae({isAuth:s}){const{id:t}=M(),a=R(),r=f(Se),i=f(T),l=f(Oe),_=f(Ce),c=f(Re),o=f(be),n=f(ye),m=f(Ee),u=f(me),d=f(ue),p=f(de),g=f(z),w=f(D).some(h=>h.id===t);E.useEffect(()=>{t&&(a(I(t)),a(q(t)),a($(t)))},[a,t]);const N=()=>{if(r){if(i!==V.Auth){a(K("You need to log in to add to favorites")),a(J());return}const h=w?0:1;a(Q({offerId:r.id,status:h}))}};if(l||n||d)return e.jsx(H,{});if(c===404)return e.jsx(U,{to:B.NotFound});if(_||m||p||!r)return e.jsx(W,{});const b=`${Math.round(C(r))}%`,{host:v,images:x,goods:y}=r;return e.jsxs("div",{className:"page",children:[e.jsx(G,{}),e.jsxs("main",{className:"page__main page__main--offer",children:[e.jsxs("section",{className:"offer",children:[e.jsx("div",{className:"offer__gallery-container container",children:e.jsx("div",{className:"offer__gallery",children:x.slice(0,6).map(h=>e.jsx("div",{className:"offer__image-wrapper",children:e.jsx("img",{className:"offer__image",src:h,alt:"Photo studio"})},h))})}),e.jsx("div",{className:"offer__container container",children:e.jsxs("div",{className:"offer__wrapper",children:[r.isPremium&&e.jsx("div",{className:"offer__mark",children:e.jsx("span",{children:"Premium"})}),e.jsxs("div",{className:"offer__name-wrapper",children:[e.jsx("h1",{className:"offer__name",children:r.title}),e.jsxs("button",{className:X("offer__bookmark-button button",w&&"offer__bookmark-button--active"),type:"button",onClick:N,disabled:g,children:[e.jsx("svg",{className:"offer__bookmark-icon",width:"31",height:"33",children:e.jsx("use",{xlinkHref:"#icon-bookmark"})}),e.jsx("span",{className:"visually-hidden",children:"To bookmarks"})]})]}),e.jsxs("div",{className:"offer__rating rating",children:[e.jsxs("div",{className:"offer__stars rating__stars",children:[e.jsx("span",{style:{width:b}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]}),e.jsx("span",{className:"offer__rating-value rating__value",children:r.rating})]}),e.jsxs("ul",{className:"offer__features",children:[e.jsx("li",{className:"offer__feature offer__feature--entire",children:r.type}),e.jsxs("li",{className:"offer__feature offer__feature--bedrooms",children:[r.bedrooms," Bedrooms"]}),e.jsxs("li",{className:"offer__feature offer__feature--adults",children:["Max ",r.maxAdults," adults"]})]}),e.jsxs("div",{className:"offer__price",children:[e.jsxs("b",{className:"offer__price-value",children:["€",r.price]}),e.jsx("span",{className:"offer__price-text",children:" night"})]}),e.jsxs("div",{className:"offer__inside",children:[e.jsx("h2",{className:"offer__inside-title",children:"What's inside"}),e.jsx("ul",{className:"offer__inside-list",children:y.map(h=>e.jsx("li",{className:"offer__inside-item",children:h},h))})]}),e.jsxs("div",{className:"offer__host",children:[e.jsx("h2",{className:"offer__host-title",children:"Meet the host"}),e.jsxs("div",{className:"offer__host-user user",children:[e.jsx("div",{className:`offer__avatar-wrapper ${v.isPro?"offer__avatar-wrapper--pro":""} user__avatar-wrapper`,children:e.jsx("img",{className:"offer__avatar user__avatar",src:v.avatarUrl,width:"74",height:"74",alt:"Host avatar"})}),e.jsx("span",{className:"offer__user-name",children:v.name}),v.isPro&&e.jsx("span",{className:"offer__user-status",children:"Pro"})]}),e.jsx("div",{className:"offer__description",children:e.jsx("p",{className:"offer__text",children:r.description})})]}),e.jsx(je,{isAuth:s,reviews:u,offerId:r.id})]})}),e.jsx("section",{className:"offer__map map",children:e.jsx(Y,{className:"offer__map",offers:[r,...o],activeOfferId:r.id})})]}),e.jsx(oe,{offers:o,className:"near-places__list places__list"})]})]})}export{Ae as default};
