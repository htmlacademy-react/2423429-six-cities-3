import{j as e,f as L,h as C,r as j,b as R,u as _,p as k,M as F,i as A,k as M,m as T,n as q,o as z,N as D,d as I,F as O,H as $,q as H}from"./index-5c63d30f.js";var N="NOT_FOUND";function U(s){var r;return{get:function(t){return r&&s(r.key,t)?r.value:N},put:function(t,i){r={key:t,value:i}},getEntries:function(){return r?[r]:[]},clear:function(){r=void 0}}}function G(s,r){var a=[];function t(o){var c=a.findIndex(function(f){return r(o,f.key)});if(c>-1){var n=a[c];return c>0&&(a.splice(c,1),a.unshift(n)),n.value}return N}function i(o,c){t(o)===N&&(a.unshift({key:o,value:c}),a.length>s&&a.pop())}function l(){return a}function d(){a=[]}return{get:t,put:i,getEntries:l,clear:d}}var W=function(r,a){return r===a};function B(s){return function(a,t){if(a===null||t===null||a.length!==t.length)return!1;for(var i=a.length,l=0;l<i;l++)if(!s(a[l],t[l]))return!1;return!0}}function X(s,r){var a=typeof r=="object"?r:{equalityCheck:r},t=a.equalityCheck,i=t===void 0?W:t,l=a.maxSize,d=l===void 0?1:l,o=a.resultEqualityCheck,c=B(i),n=d===1?U(c):G(d,c);function f(){var m=n.get(arguments);if(m===N){if(m=s.apply(null,arguments),o){var u=n.getEntries(),v=u.find(function(h){return o(h.value,m)});v&&(m=v.value)}n.put(arguments,m)}return m}return f.clearCache=function(){return n.clear()},f}function Y(s){var r=Array.isArray(s[0])?s[0]:s;if(!r.every(function(t){return typeof t=="function"})){var a=r.map(function(t){return typeof t=="function"?"function "+(t.name||"unnamed")+"()":typeof t}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+a+"]")}return r}function K(s){for(var r=arguments.length,a=new Array(r>1?r-1:0),t=1;t<r;t++)a[t-1]=arguments[t];var i=function(){for(var d=arguments.length,o=new Array(d),c=0;c<d;c++)o[c]=arguments[c];var n=0,f,m={memoizeOptions:void 0},u=o.pop();if(typeof u=="object"&&(m=u,u=o.pop()),typeof u!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof u+"]");var v=m,h=v.memoizeOptions,g=h===void 0?a:h,w=Array.isArray(g)?g:[g],p=Y(o),y=s.apply(void 0,[function(){return n++,u.apply(null,arguments)}].concat(w)),E=s(function(){for(var S=[],P=p.length,b=0;b<P;b++)S.push(p[b].apply(null,arguments));return f=y.apply(null,S),f});return Object.assign(E,{resultFunc:u,memoizedResultFunc:y,dependencies:p,lastResult:function(){return f},recomputations:function(){return n},resetRecomputations:function(){return n=0}}),E};return i}var V=K(X);function J({offers:s,className:r="near-places__list places__list"}){return e.jsx("div",{className:"container",children:e.jsxs("section",{className:"near-places places",children:[e.jsx("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),e.jsx(L,{offers:s,className:r})]})})}function Q({review:s}){const r=new Date(s.date);return e.jsxs("li",{className:"reviews__item",children:[e.jsxs("div",{className:"reviews__user user",children:[e.jsx("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:e.jsx("img",{className:"reviews__avatar user__avatar",src:s.user.avatarUrl,width:"54",height:"54",alt:"Reviews avatar"})}),e.jsx("span",{className:"reviews__user-name",children:s.user.name}),s.user.isPro&&e.jsx("span",{className:"reviews__user-status",children:"Pro"})]}),e.jsxs("div",{className:"reviews__info",children:[e.jsx("div",{className:"reviews__rating rating",children:e.jsxs("div",{className:"reviews__stars rating__stars",children:[e.jsx("span",{style:{width:`${C({rating:s.rating})}%`}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]})}),e.jsx("p",{className:"reviews__text",children:s.comment}),e.jsx("time",{className:"reviews__time",dateTime:r.toISOString().slice(0,10),children:r.toLocaleString("default",{month:"long",year:"numeric"})})]})]},s.id)}const Z=({reviews:s})=>e.jsxs(j.Fragment,{children:[e.jsxs("h2",{className:"reviews__title",children:["Reviews · ",e.jsx("span",{className:"reviews__amount",children:s.length})]}),e.jsx("ul",{className:"reviews__list",children:s.map(r=>e.jsx(Q,{review:r},r.id))})]}),ee=s=>s.comments.comments,se=s=>s.comments.isCommentsLoading,re=s=>s.comments.error,ae=s=>s.comments.isPosting,te=s=>s.comments.postError,ne=[{value:5,title:"perfect"},{value:4,title:"good"},{value:3,title:"not bad"},{value:2,title:"badly"},{value:1,title:"terribly"}],ie=50,oe=300;function ce({offerId:s}){const r=R(),a=_(ae),t=_(te),[i,l]=j.useState({rating:0,comment:""}),d=i.rating>0&&i.comment.trim().length>=ie&&i.comment.trim().length<=oe,o=n=>{const f=n.target,{name:m,value:u}=f;l(v=>({...v,[m]:m==="rating"?Number(u):u}))},c=()=>{!d||a||r(k({offerId:s,comment:i.comment.trim(),rating:i.rating})).unwrap().then(()=>{l({rating:0,comment:""})})};return e.jsxs("form",{className:"reviews__form form",onSubmit:n=>{n.preventDefault(),c()},children:[e.jsx("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),e.jsx("div",{className:"reviews__rating-form form__rating",children:ne.map(({value:n,title:f})=>e.jsxs(j.Fragment,{children:[e.jsx("input",{className:"form__rating-input visually-hidden",name:"rating",value:n,id:`${n}-stars`,type:"radio",checked:i.rating===n,onChange:o,disabled:a}),e.jsx("label",{htmlFor:`${n}-stars`,className:"reviews__rating-label form__rating-label",title:f,children:e.jsx("svg",{className:"form__star-image",width:"37",height:"33",children:e.jsx("use",{xlinkHref:"#icon-star"})})})]},n))}),e.jsx("textarea",{className:"reviews__textarea form__textarea",id:"review",name:"comment",placeholder:"Tell how was your stay…",value:i.comment,onChange:o,maxLength:300,disabled:a}),e.jsxs("div",{className:"reviews__button-wrapper",children:[t&&e.jsx("div",{className:"reviews__error-message",children:t}),e.jsxs("p",{className:"reviews__help",children:["To submit review please make sure to set"," ",e.jsx("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least ",e.jsx("b",{className:"reviews__text-amount",children:"50 characters"}),"."]}),e.jsx("button",{className:"reviews__submit form__submit button",type:"submit",disabled:!d||a,children:a?"Submitting...":"Submit"})]})]})}const le=({isAuth:s,reviews:r,offerId:a})=>e.jsxs("section",{className:"offer__reviews reviews",children:[e.jsx(Z,{reviews:r}),s&&e.jsx(ce,{offerId:a})]}),fe=le,me=s=>s.nearby.offers,ue=V(me,s=>s.slice(0,F)),de=s=>s.nearby.isNearbyOffersLoading,_e=s=>s.nearby.error,he=s=>s.offer.offer,pe=s=>s.offer.isOfferLoading,ve=s=>s.offer.error,ge=s=>s.offer.errorStatus;function je({isAuth:s}){const{id:r}=A(),a=R(),t=_(he),i=_(pe),l=_(ve),d=_(ge),o=_(ue),c=_(de),n=_(_e),f=_(ee),m=_(se),u=_(re);if(j.useEffect(()=>{r&&(a(M(r)),a(T(r)),a(q(r)))},[a,r]),i||c||m)return e.jsx(z,{});if(d===404)return e.jsx(D,{to:I.NotFound});if(l||n||u)return e.jsx(O,{});if(!t)return e.jsx(O,{});const v=`${Math.round(C(t))}%`,{host:h,images:g,goods:w}=t;return e.jsxs("div",{className:"page",children:[e.jsx($,{}),e.jsxs("main",{className:"page__main page__main--offer",children:[e.jsxs("section",{className:"offer",children:[e.jsx("div",{className:"offer__gallery-container container",children:e.jsx("div",{className:"offer__gallery",children:g.slice(0,6).map(p=>e.jsx("div",{className:"offer__image-wrapper",children:e.jsx("img",{className:"offer__image",src:p,alt:"Photo studio"})},p))})}),e.jsx("div",{className:"offer__container container",children:e.jsxs("div",{className:"offer__wrapper",children:[t.isPremium&&e.jsx("div",{className:"offer__mark",children:e.jsx("span",{children:"Premium"})}),e.jsxs("div",{className:"offer__name-wrapper",children:[e.jsx("h1",{className:"offer__name",children:t.title}),e.jsxs("button",{className:"offer__bookmark-button button",type:"button",children:[e.jsx("svg",{className:"offer__bookmark-icon",width:"31",height:"33",children:e.jsx("use",{xlinkHref:"#icon-bookmark"})}),e.jsx("span",{className:"visually-hidden",children:"To bookmarks"})]})]}),e.jsxs("div",{className:"offer__rating rating",children:[e.jsxs("div",{className:"offer__stars rating__stars",children:[e.jsx("span",{style:{width:v}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]}),e.jsx("span",{className:"offer__rating-value rating__value",children:t.rating})]}),e.jsxs("ul",{className:"offer__features",children:[e.jsx("li",{className:"offer__feature offer__feature--entire",children:t.type}),e.jsxs("li",{className:"offer__feature offer__feature--bedrooms",children:[t.bedrooms," Bedrooms"]}),e.jsxs("li",{className:"offer__feature offer__feature--adults",children:["Max ",t.maxAdults," adults"]})]}),e.jsxs("div",{className:"offer__price",children:[e.jsxs("b",{className:"offer__price-value",children:["€",t.price]}),e.jsx("span",{className:"offer__price-text",children:" night"})]}),e.jsxs("div",{className:"offer__inside",children:[e.jsx("h2",{className:"offer__inside-title",children:"What's inside"}),e.jsx("ul",{className:"offer__inside-list",children:w.map(p=>e.jsx("li",{className:"offer__inside-item",children:p},p))})]}),e.jsxs("div",{className:"offer__host",children:[e.jsx("h2",{className:"offer__host-title",children:"Meet the host"}),e.jsxs("div",{className:"offer__host-user user",children:[e.jsx("div",{className:`offer__avatar-wrapper ${h.isPro?"offer__avatar-wrapper--pro":""} user__avatar-wrapper`,children:e.jsx("img",{className:"offer__avatar user__avatar",src:h.avatarUrl,width:"74",height:"74",alt:"Host avatar"})}),e.jsx("span",{className:"offer__user-name",children:h.name}),h.isPro&&e.jsx("span",{className:"offer__user-status",children:"Pro"})]}),e.jsx("div",{className:"offer__description",children:e.jsx("p",{className:"offer__text",children:t.description})})]}),e.jsx(fe,{isAuth:s,reviews:f,offerId:t.id})]})}),e.jsx("section",{className:"offer__map map",children:e.jsx(H,{className:"offer__map",offers:[t,...o],activeOfferId:t.id})})]}),e.jsx(J,{offers:o,className:"near-places__list places__list"})]})]})}export{je as default};
