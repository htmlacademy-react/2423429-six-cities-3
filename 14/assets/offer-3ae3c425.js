import{j as e,m as F,n as C,r as w,b as k,u as d,p as P,M as L,o as A,f as M,q as T,t as I,v as q,k as z,N as D,d as $,F as S,H,w as U,x as B,y as G}from"./index-5a85ae1e.js";var b="NOT_FOUND";function W(s){var a;return{get:function(r){return a&&s(a.key,r)?a.value:b},put:function(r,i){a={key:r,value:i}},getEntries:function(){return a?[a]:[]},clear:function(){a=void 0}}}function X(s,a){var t=[];function r(o){var c=t.findIndex(function(f){return a(o,f.key)});if(c>-1){var n=t[c];return c>0&&(t.splice(c,1),t.unshift(n)),n.value}return b}function i(o,c){r(o)===b&&(t.unshift({key:o,value:c}),t.length>s&&t.pop())}function l(){return t}function _(){t=[]}return{get:r,put:i,getEntries:l,clear:_}}var Y=function(a,t){return a===t};function K(s){return function(t,r){if(t===null||r===null||t.length!==r.length)return!1;for(var i=t.length,l=0;l<i;l++)if(!s(t[l],r[l]))return!1;return!0}}function V(s,a){var t=typeof a=="object"?a:{equalityCheck:a},r=t.equalityCheck,i=r===void 0?Y:r,l=t.maxSize,_=l===void 0?1:l,o=t.resultEqualityCheck,c=K(i),n=_===1?W(c):X(_,c);function f(){var m=n.get(arguments);if(m===b){if(m=s.apply(null,arguments),o){var u=n.getEntries(),v=u.find(function(g){return o(g.value,m)});v&&(m=v.value)}n.put(arguments,m)}return m}return f.clearCache=function(){return n.clear()},f}function J(s){var a=Array.isArray(s[0])?s[0]:s;if(!a.every(function(r){return typeof r=="function"})){var t=a.map(function(r){return typeof r=="function"?"function "+(r.name||"unnamed")+"()":typeof r}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+t+"]")}return a}function Q(s){for(var a=arguments.length,t=new Array(a>1?a-1:0),r=1;r<a;r++)t[r-1]=arguments[r];var i=function(){for(var _=arguments.length,o=new Array(_),c=0;c<_;c++)o[c]=arguments[c];var n=0,f,m={memoizeOptions:void 0},u=o.pop();if(typeof u=="object"&&(m=u,u=o.pop()),typeof u!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof u+"]");var v=m,g=v.memoizeOptions,x=g===void 0?t:g,y=Array.isArray(x)?x:[x],p=J(o),j=s.apply(void 0,[function(){return n++,u.apply(null,arguments)}].concat(y)),N=s(function(){for(var O=[],R=p.length,E=0;E<R;E++)O.push(p[E].apply(null,arguments));return f=j.apply(null,O),f});return Object.assign(N,{resultFunc:u,memoizedResultFunc:j,dependencies:p,lastResult:function(){return f},recomputations:function(){return n},resetRecomputations:function(){return n=0}}),N};return i}var Z=Q(V);function ee({offers:s,className:a="near-places__list places__list"}){return e.jsx("div",{className:"container",children:e.jsxs("section",{className:"near-places places",children:[e.jsx("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),e.jsx(F,{offers:s,className:a})]})})}function se({review:s}){const a=new Date(s.date);return e.jsxs("li",{className:"reviews__item",children:[e.jsxs("div",{className:"reviews__user user",children:[e.jsx("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:e.jsx("img",{className:"reviews__avatar user__avatar",src:s.user.avatarUrl,width:"54",height:"54",alt:"Reviews avatar"})}),e.jsx("span",{className:"reviews__user-name",children:s.user.name}),s.user.isPro&&e.jsx("span",{className:"reviews__user-status",children:"Pro"})]}),e.jsxs("div",{className:"reviews__info",children:[e.jsx("div",{className:"reviews__rating rating",children:e.jsxs("div",{className:"reviews__stars rating__stars",children:[e.jsx("span",{style:{width:`${C({rating:s.rating})}%`}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]})}),e.jsx("p",{className:"reviews__text",children:s.comment}),e.jsx("time",{className:"reviews__time",dateTime:a.toISOString().slice(0,10),children:a.toLocaleString("default",{month:"long",year:"numeric"})})]})]},s.id)}const re=({reviews:s})=>e.jsxs(w.Fragment,{children:[e.jsxs("h2",{className:"reviews__title",children:["Reviews · ",e.jsx("span",{className:"reviews__amount",children:s.length})]}),e.jsx("ul",{className:"reviews__list",children:s.map(a=>e.jsx(se,{review:a},a.id))})]}),ae=s=>s.comments.comments,te=s=>s.comments.isCommentsLoading,ne=s=>s.comments.error,ie=s=>s.comments.isPosting,oe=s=>s.comments.postError,ce=[{value:5,title:"perfect"},{value:4,title:"good"},{value:3,title:"not bad"},{value:2,title:"badly"},{value:1,title:"terribly"}],le=50,fe=300;function me({offerId:s}){const a=k(),t=d(ie),r=d(oe),[i,l]=w.useState({rating:0,comment:""}),_=i.rating>0&&i.comment.trim().length>=le&&i.comment.trim().length<=fe,o=n=>{const f=n.target,{name:m,value:u}=f;l(v=>({...v,[m]:m==="rating"?Number(u):u}))},c=()=>{!_||t||a(P({offerId:s,comment:i.comment.trim(),rating:i.rating})).unwrap().then(()=>{l({rating:0,comment:""})})};return e.jsxs("form",{className:"reviews__form form",onSubmit:n=>{n.preventDefault(),c()},children:[e.jsx("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),e.jsx("div",{className:"reviews__rating-form form__rating",children:ce.map(({value:n,title:f})=>e.jsxs(w.Fragment,{children:[e.jsx("input",{className:"form__rating-input visually-hidden",name:"rating",value:n,id:`${n}-stars`,type:"radio",checked:i.rating===n,onChange:o,disabled:t}),e.jsx("label",{htmlFor:`${n}-stars`,className:"reviews__rating-label form__rating-label",title:f,children:e.jsx("svg",{className:"form__star-image",width:"37",height:"33",children:e.jsx("use",{xlinkHref:"#icon-star"})})})]},n))}),e.jsx("textarea",{className:"reviews__textarea form__textarea",id:"review",name:"comment",placeholder:"Tell how was your stay…",value:i.comment,onChange:o,maxLength:300,disabled:t}),e.jsxs("div",{className:"reviews__button-wrapper",children:[r&&e.jsx("div",{className:"reviews__error-message",children:r}),e.jsxs("p",{className:"reviews__help",children:["To submit review please make sure to set"," ",e.jsx("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least ",e.jsx("b",{className:"reviews__text-amount",children:"50 characters"}),"."]}),e.jsx("button",{className:"reviews__submit form__submit button",type:"submit",disabled:!_||t,children:t?"Submitting...":"Submit"})]})]})}const ue=({isAuth:s,reviews:a,offerId:t})=>e.jsxs("section",{className:"offer__reviews reviews",children:[e.jsx(re,{reviews:a}),s&&e.jsx(me,{offerId:t})]}),de=ue,_e=s=>s.nearby.offers,he=Z(_e,s=>s.slice(0,L)),pe=s=>s.nearby.isNearbyOffersLoading,ve=s=>s.nearby.error,ge=s=>s.offer.offer,xe=s=>s.offer.isOfferLoading,je=s=>s.offer.error,Ne=s=>s.offer.errorStatus;function be({isAuth:s}){const{id:a}=A(),t=k(),r=d(ge),i=d(xe),l=d(je),_=d(Ne),o=d(he),c=d(pe),n=d(ve),f=d(ae),m=d(te),u=d(ne),g=d(M).some(h=>h.id===a);w.useEffect(()=>{a&&(t(T(a)),t(I(a)),t(q(a)))},[t,a]);const x=()=>{r&&t(G({offerId:r.id,status:g?0:1}))};if(i||c||m)return e.jsx(z,{});if(_===404)return e.jsx(D,{to:$.NotFound});if(l||n||u)return e.jsx(S,{});if(!r)return e.jsx(S,{});const y=`${Math.round(C(r))}%`,{host:p,images:j,goods:N}=r;return e.jsxs("div",{className:"page",children:[e.jsx(H,{}),e.jsxs("main",{className:"page__main page__main--offer",children:[e.jsxs("section",{className:"offer",children:[e.jsx("div",{className:"offer__gallery-container container",children:e.jsx("div",{className:"offer__gallery",children:j.slice(0,6).map(h=>e.jsx("div",{className:"offer__image-wrapper",children:e.jsx("img",{className:"offer__image",src:h,alt:"Photo studio"})},h))})}),e.jsx("div",{className:"offer__container container",children:e.jsxs("div",{className:"offer__wrapper",children:[r.isPremium&&e.jsx("div",{className:"offer__mark",children:e.jsx("span",{children:"Premium"})}),e.jsxs("div",{className:"offer__name-wrapper",children:[e.jsx("h1",{className:"offer__name",children:r.title}),e.jsxs("button",{className:U("offer__bookmark-button button",g&&"offer__bookmark-button--active"),type:"button",onClick:x,children:[e.jsx("svg",{className:"offer__bookmark-icon",width:"31",height:"33",children:e.jsx("use",{xlinkHref:"#icon-bookmark"})}),e.jsx("span",{className:"visually-hidden",children:"To bookmarks"})]})]}),e.jsxs("div",{className:"offer__rating rating",children:[e.jsxs("div",{className:"offer__stars rating__stars",children:[e.jsx("span",{style:{width:y}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]}),e.jsx("span",{className:"offer__rating-value rating__value",children:r.rating})]}),e.jsxs("ul",{className:"offer__features",children:[e.jsx("li",{className:"offer__feature offer__feature--entire",children:r.type}),e.jsxs("li",{className:"offer__feature offer__feature--bedrooms",children:[r.bedrooms," Bedrooms"]}),e.jsxs("li",{className:"offer__feature offer__feature--adults",children:["Max ",r.maxAdults," adults"]})]}),e.jsxs("div",{className:"offer__price",children:[e.jsxs("b",{className:"offer__price-value",children:["€",r.price]}),e.jsx("span",{className:"offer__price-text",children:" night"})]}),e.jsxs("div",{className:"offer__inside",children:[e.jsx("h2",{className:"offer__inside-title",children:"What's inside"}),e.jsx("ul",{className:"offer__inside-list",children:N.map(h=>e.jsx("li",{className:"offer__inside-item",children:h},h))})]}),e.jsxs("div",{className:"offer__host",children:[e.jsx("h2",{className:"offer__host-title",children:"Meet the host"}),e.jsxs("div",{className:"offer__host-user user",children:[e.jsx("div",{className:`offer__avatar-wrapper ${p.isPro?"offer__avatar-wrapper--pro":""} user__avatar-wrapper`,children:e.jsx("img",{className:"offer__avatar user__avatar",src:p.avatarUrl,width:"74",height:"74",alt:"Host avatar"})}),e.jsx("span",{className:"offer__user-name",children:p.name}),p.isPro&&e.jsx("span",{className:"offer__user-status",children:"Pro"})]}),e.jsx("div",{className:"offer__description",children:e.jsx("p",{className:"offer__text",children:r.description})})]}),e.jsx(de,{isAuth:s,reviews:f,offerId:r.id})]})}),e.jsx("section",{className:"offer__map map",children:e.jsx(B,{className:"offer__map",offers:[r,...o],activeOfferId:r.id})})]}),e.jsx(ee,{offers:o,className:"near-places__list places__list"})]})]})}export{be as default};
