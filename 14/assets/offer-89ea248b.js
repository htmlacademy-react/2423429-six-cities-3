import{j as e,m as P,n as C,r as j,b as R,u as _,p as L,M as F,o as A,q as M,t as T,v as q,k as z,N as D,d as I,F as O,H as $,w as H,x as U}from"./index-c09dc745.js";var N="NOT_FOUND";function G(s){var a;return{get:function(r){return a&&s(a.key,r)?a.value:N},put:function(r,i){a={key:r,value:i}},getEntries:function(){return a?[a]:[]},clear:function(){a=void 0}}}function W(s,a){var t=[];function r(o){var c=t.findIndex(function(f){return a(o,f.key)});if(c>-1){var n=t[c];return c>0&&(t.splice(c,1),t.unshift(n)),n.value}return N}function i(o,c){r(o)===N&&(t.unshift({key:o,value:c}),t.length>s&&t.pop())}function l(){return t}function d(){t=[]}return{get:r,put:i,getEntries:l,clear:d}}var B=function(a,t){return a===t};function X(s){return function(t,r){if(t===null||r===null||t.length!==r.length)return!1;for(var i=t.length,l=0;l<i;l++)if(!s(t[l],r[l]))return!1;return!0}}function Y(s,a){var t=typeof a=="object"?a:{equalityCheck:a},r=t.equalityCheck,i=r===void 0?B:r,l=t.maxSize,d=l===void 0?1:l,o=t.resultEqualityCheck,c=X(i),n=d===1?G(c):W(d,c);function f(){var m=n.get(arguments);if(m===N){if(m=s.apply(null,arguments),o){var u=n.getEntries(),v=u.find(function(h){return o(h.value,m)});v&&(m=v.value)}n.put(arguments,m)}return m}return f.clearCache=function(){return n.clear()},f}function K(s){var a=Array.isArray(s[0])?s[0]:s;if(!a.every(function(r){return typeof r=="function"})){var t=a.map(function(r){return typeof r=="function"?"function "+(r.name||"unnamed")+"()":typeof r}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+t+"]")}return a}function V(s){for(var a=arguments.length,t=new Array(a>1?a-1:0),r=1;r<a;r++)t[r-1]=arguments[r];var i=function(){for(var d=arguments.length,o=new Array(d),c=0;c<d;c++)o[c]=arguments[c];var n=0,f,m={memoizeOptions:void 0},u=o.pop();if(typeof u=="object"&&(m=u,u=o.pop()),typeof u!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof u+"]");var v=m,h=v.memoizeOptions,g=h===void 0?t:h,w=Array.isArray(g)?g:[g],p=K(o),y=s.apply(void 0,[function(){return n++,u.apply(null,arguments)}].concat(w)),E=s(function(){for(var S=[],k=p.length,b=0;b<k;b++)S.push(p[b].apply(null,arguments));return f=y.apply(null,S),f});return Object.assign(E,{resultFunc:u,memoizedResultFunc:y,dependencies:p,lastResult:function(){return f},recomputations:function(){return n},resetRecomputations:function(){return n=0}}),E};return i}var J=V(Y);function Q({offers:s,className:a="near-places__list places__list"}){return e.jsx("div",{className:"container",children:e.jsxs("section",{className:"near-places places",children:[e.jsx("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),e.jsx(P,{offers:s,className:a})]})})}function Z({review:s}){const a=new Date(s.date);return e.jsxs("li",{className:"reviews__item",children:[e.jsxs("div",{className:"reviews__user user",children:[e.jsx("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:e.jsx("img",{className:"reviews__avatar user__avatar",src:s.user.avatarUrl,width:"54",height:"54",alt:"Reviews avatar"})}),e.jsx("span",{className:"reviews__user-name",children:s.user.name}),s.user.isPro&&e.jsx("span",{className:"reviews__user-status",children:"Pro"})]}),e.jsxs("div",{className:"reviews__info",children:[e.jsx("div",{className:"reviews__rating rating",children:e.jsxs("div",{className:"reviews__stars rating__stars",children:[e.jsx("span",{style:{width:`${C({rating:s.rating})}%`}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]})}),e.jsx("p",{className:"reviews__text",children:s.comment}),e.jsx("time",{className:"reviews__time",dateTime:a.toISOString().slice(0,10),children:a.toLocaleString("default",{month:"long",year:"numeric"})})]})]},s.id)}const ee=({reviews:s})=>e.jsxs(j.Fragment,{children:[e.jsxs("h2",{className:"reviews__title",children:["Reviews · ",e.jsx("span",{className:"reviews__amount",children:s.length})]}),e.jsx("ul",{className:"reviews__list",children:s.map(a=>e.jsx(Z,{review:a},a.id))})]}),se=s=>s.comments.comments,re=s=>s.comments.isCommentsLoading,ae=s=>s.comments.error,te=s=>s.comments.isPosting,ne=s=>s.comments.postError,ie=[{value:5,title:"perfect"},{value:4,title:"good"},{value:3,title:"not bad"},{value:2,title:"badly"},{value:1,title:"terribly"}],oe=50,ce=300;function le({offerId:s}){const a=R(),t=_(te),r=_(ne),[i,l]=j.useState({rating:0,comment:""}),d=i.rating>0&&i.comment.trim().length>=oe&&i.comment.trim().length<=ce,o=n=>{const f=n.target,{name:m,value:u}=f;l(v=>({...v,[m]:m==="rating"?Number(u):u}))},c=()=>{!d||t||a(L({offerId:s,comment:i.comment.trim(),rating:i.rating})).unwrap().then(()=>{l({rating:0,comment:""})})};return e.jsxs("form",{className:"reviews__form form",onSubmit:n=>{n.preventDefault(),c()},children:[e.jsx("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),e.jsx("div",{className:"reviews__rating-form form__rating",children:ie.map(({value:n,title:f})=>e.jsxs(j.Fragment,{children:[e.jsx("input",{className:"form__rating-input visually-hidden",name:"rating",value:n,id:`${n}-stars`,type:"radio",checked:i.rating===n,onChange:o,disabled:t}),e.jsx("label",{htmlFor:`${n}-stars`,className:"reviews__rating-label form__rating-label",title:f,children:e.jsx("svg",{className:"form__star-image",width:"37",height:"33",children:e.jsx("use",{xlinkHref:"#icon-star"})})})]},n))}),e.jsx("textarea",{className:"reviews__textarea form__textarea",id:"review",name:"comment",placeholder:"Tell how was your stay…",value:i.comment,onChange:o,maxLength:300,disabled:t}),e.jsxs("div",{className:"reviews__button-wrapper",children:[r&&e.jsx("div",{className:"reviews__error-message",children:r}),e.jsxs("p",{className:"reviews__help",children:["To submit review please make sure to set"," ",e.jsx("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least ",e.jsx("b",{className:"reviews__text-amount",children:"50 characters"}),"."]}),e.jsx("button",{className:"reviews__submit form__submit button",type:"submit",disabled:!d||t,children:t?"Submitting...":"Submit"})]})]})}const fe=({isAuth:s,reviews:a,offerId:t})=>e.jsxs("section",{className:"offer__reviews reviews",children:[e.jsx(ee,{reviews:a}),s&&e.jsx(le,{offerId:t})]}),me=fe,ue=s=>s.nearby.offers,de=J(ue,s=>s.slice(0,F)),_e=s=>s.nearby.isNearbyOffersLoading,he=s=>s.nearby.error,pe=s=>s.offer.offer,ve=s=>s.offer.isOfferLoading,ge=s=>s.offer.error,xe=s=>s.offer.errorStatus;function Ne({isAuth:s}){const{id:a}=A(),t=R(),r=_(pe),i=_(ve),l=_(ge),d=_(xe),o=_(de),c=_(_e),n=_(he),f=_(se),m=_(re),u=_(ae);if(j.useEffect(()=>{a&&(t(M(a)),t(T(a)),t(q(a)))},[t,a]),i||c||m)return e.jsx(z,{});if(d===404)return e.jsx(D,{to:I.NotFound});if(l||n||u)return e.jsx(O,{});if(!r)return e.jsx(O,{});const v=`${Math.round(C(r))}%`,{host:h,images:g,goods:w}=r;return e.jsxs("div",{className:"page",children:[e.jsx($,{}),e.jsxs("main",{className:"page__main page__main--offer",children:[e.jsxs("section",{className:"offer",children:[e.jsx("div",{className:"offer__gallery-container container",children:e.jsx("div",{className:"offer__gallery",children:g.slice(0,6).map(p=>e.jsx("div",{className:"offer__image-wrapper",children:e.jsx("img",{className:"offer__image",src:p,alt:"Photo studio"})},p))})}),e.jsx("div",{className:"offer__container container",children:e.jsxs("div",{className:"offer__wrapper",children:[r.isPremium&&e.jsx("div",{className:"offer__mark",children:e.jsx("span",{children:"Premium"})}),e.jsxs("div",{className:"offer__name-wrapper",children:[e.jsx("h1",{className:"offer__name",children:r.title}),e.jsxs("button",{className:H("offer__bookmark-button button",r.isFavorite&&"offer__bookmark-button--active"),type:"button",children:[e.jsx("svg",{className:"offer__bookmark-icon",width:"31",height:"33",children:e.jsx("use",{xlinkHref:"#icon-bookmark"})}),e.jsx("span",{className:"visually-hidden",children:"To bookmarks"})]})]}),e.jsxs("div",{className:"offer__rating rating",children:[e.jsxs("div",{className:"offer__stars rating__stars",children:[e.jsx("span",{style:{width:v}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]}),e.jsx("span",{className:"offer__rating-value rating__value",children:r.rating})]}),e.jsxs("ul",{className:"offer__features",children:[e.jsx("li",{className:"offer__feature offer__feature--entire",children:r.type}),e.jsxs("li",{className:"offer__feature offer__feature--bedrooms",children:[r.bedrooms," Bedrooms"]}),e.jsxs("li",{className:"offer__feature offer__feature--adults",children:["Max ",r.maxAdults," adults"]})]}),e.jsxs("div",{className:"offer__price",children:[e.jsxs("b",{className:"offer__price-value",children:["€",r.price]}),e.jsx("span",{className:"offer__price-text",children:" night"})]}),e.jsxs("div",{className:"offer__inside",children:[e.jsx("h2",{className:"offer__inside-title",children:"What's inside"}),e.jsx("ul",{className:"offer__inside-list",children:w.map(p=>e.jsx("li",{className:"offer__inside-item",children:p},p))})]}),e.jsxs("div",{className:"offer__host",children:[e.jsx("h2",{className:"offer__host-title",children:"Meet the host"}),e.jsxs("div",{className:"offer__host-user user",children:[e.jsx("div",{className:`offer__avatar-wrapper ${h.isPro?"offer__avatar-wrapper--pro":""} user__avatar-wrapper`,children:e.jsx("img",{className:"offer__avatar user__avatar",src:h.avatarUrl,width:"74",height:"74",alt:"Host avatar"})}),e.jsx("span",{className:"offer__user-name",children:h.name}),h.isPro&&e.jsx("span",{className:"offer__user-status",children:"Pro"})]}),e.jsx("div",{className:"offer__description",children:e.jsx("p",{className:"offer__text",children:r.description})})]}),e.jsx(me,{isAuth:s,reviews:f,offerId:r.id})]})}),e.jsx("section",{className:"offer__map map",children:e.jsx(U,{className:"offer__map",offers:[r,...o],activeOfferId:r.id})})]}),e.jsx(Q,{offers:o,className:"near-places__list places__list"})]})]})}export{Ne as default};
