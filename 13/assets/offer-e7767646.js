import{j as e,f as k,h as R,r as j,M as F,i as L,b as P,u as _,k as A,m as z,n as D,o as M,N as $,d as q,F as E,H as T,p as I}from"./index-00fe11e3.js";var N="NOT_FOUND";function H(r){var s;return{get:function(a){return s&&r(s.key,a)?s.value:N},put:function(a,l){s={key:a,value:l}},getEntries:function(){return s?[s]:[]},clear:function(){s=void 0}}}function U(r,s){var t=[];function a(n){var o=t.findIndex(function(d){return s(n,d.key)});if(o>-1){var c=t[o];return o>0&&(t.splice(o,1),t.unshift(c)),c.value}return N}function l(n,o){a(n)===N&&(t.unshift({key:n,value:o}),t.length>r&&t.pop())}function f(){return t}function i(){t=[]}return{get:a,put:l,getEntries:f,clear:i}}var W=function(s,t){return s===t};function B(r){return function(t,a){if(t===null||a===null||t.length!==a.length)return!1;for(var l=t.length,f=0;f<l;f++)if(!r(t[f],a[f]))return!1;return!0}}function Y(r,s){var t=typeof s=="object"?s:{equalityCheck:s},a=t.equalityCheck,l=a===void 0?W:a,f=t.maxSize,i=f===void 0?1:f,n=t.resultEqualityCheck,o=B(l),c=i===1?H(o):U(i,o);function d(){var u=c.get(arguments);if(u===N){if(u=r.apply(null,arguments),n){var m=c.getEntries(),v=m.find(function(h){return n(h.value,u)});v&&(u=v.value)}c.put(arguments,u)}return u}return d.clearCache=function(){return c.clear()},d}function G(r){var s=Array.isArray(r[0])?r[0]:r;if(!s.every(function(a){return typeof a=="function"})){var t=s.map(function(a){return typeof a=="function"?"function "+(a.name||"unnamed")+"()":typeof a}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+t+"]")}return s}function K(r){for(var s=arguments.length,t=new Array(s>1?s-1:0),a=1;a<s;a++)t[a-1]=arguments[a];var l=function(){for(var i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];var c=0,d,u={memoizeOptions:void 0},m=n.pop();if(typeof m=="object"&&(u=m,m=n.pop()),typeof m!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof m+"]");var v=u,h=v.memoizeOptions,g=h===void 0?t:h,w=Array.isArray(g)?g:[g],p=G(n),b=r.apply(void 0,[function(){return c++,m.apply(null,arguments)}].concat(w)),S=r(function(){for(var O=[],C=p.length,y=0;y<C;y++)O.push(p[y].apply(null,arguments));return d=b.apply(null,O),d});return Object.assign(S,{resultFunc:m,memoizedResultFunc:b,dependencies:p,lastResult:function(){return d},recomputations:function(){return c},resetRecomputations:function(){return c=0}}),S};return l}var V=K(Y);function X({offers:r,className:s="near-places__list places__list"}){return e.jsx("div",{className:"container",children:e.jsxs("section",{className:"near-places places",children:[e.jsx("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),e.jsx(k,{offers:r,className:s})]})})}function J({review:r}){const s=new Date(r.date);return e.jsxs("li",{className:"reviews__item",children:[e.jsxs("div",{className:"reviews__user user",children:[e.jsx("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:e.jsx("img",{className:"reviews__avatar user__avatar",src:r.user.avatarUrl,width:"54",height:"54",alt:"Reviews avatar"})}),e.jsx("span",{className:"reviews__user-name",children:r.user.name}),r.user.isPro&&e.jsx("span",{className:"reviews__user-status",children:"Pro"})]}),e.jsxs("div",{className:"reviews__info",children:[e.jsx("div",{className:"reviews__rating rating",children:e.jsxs("div",{className:"reviews__stars rating__stars",children:[e.jsx("span",{style:{width:`${R({rating:r.rating})}%`}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]})}),e.jsx("p",{className:"reviews__text",children:r.comment}),e.jsx("time",{className:"reviews__time",dateTime:s.toISOString().slice(0,10),children:s.toLocaleString("default",{month:"long",year:"numeric"})})]})]},r.id)}const Q=({reviews:r})=>e.jsxs(j.Fragment,{children:[e.jsxs("h2",{className:"reviews__title",children:["Reviews · ",e.jsx("span",{className:"reviews__amount",children:r.length})]}),e.jsx("ul",{className:"reviews__list",children:r.map(s=>e.jsx(J,{review:s},s.id))})]}),Z=[{value:5,title:"perfect"},{value:4,title:"good"},{value:3,title:"not bad"},{value:2,title:"badly"},{value:1,title:"terribly"}];function ee({onSubmit:r}){const[s,t]=j.useState({rating:0,comment:""}),a=i=>{const{name:n,value:o}=i.target;t(c=>({...c,[n]:n==="rating"?Number(o):o}))},l=s.rating>0&&s.comment.trim().length>=50,f=i=>{i.preventDefault(),l&&(r({rating:s.rating,comment:s.comment}),t({rating:0,comment:""}))};return e.jsxs("form",{className:"reviews__form form",onSubmit:f,children:[e.jsx("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),e.jsx("div",{className:"reviews__rating-form form__rating",children:Z.map(({value:i,title:n})=>e.jsxs(j.Fragment,{children:[e.jsx("input",{className:"form__rating-input visually-hidden",name:"rating",value:i,id:`${i}-stars`,type:"radio",checked:s.rating===i,onChange:a}),e.jsx("label",{htmlFor:`${i}-stars`,className:"reviews__rating-label form__rating-label",title:n,children:e.jsx("svg",{className:"form__star-image",width:"37",height:"33",children:e.jsx("use",{xlinkHref:"#icon-star"})})})]},i))}),e.jsx("textarea",{className:"reviews__textarea form__textarea",id:"review",name:"comment",placeholder:"Tell how was your stay…",value:s.comment,onChange:a}),e.jsxs("div",{className:"reviews__button-wrapper",children:[e.jsxs("p",{className:"reviews__help",children:["To submit review please make sure to set"," ",e.jsx("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least ",e.jsx("b",{className:"reviews__text-amount",children:"50 characters"}),"."]}),e.jsx("button",{className:"reviews__submit form__submit button",type:"submit",disabled:!l,children:"Submit"})]})]})}const re=({isAuth:r,reviews:s})=>{const t=a=>{console.log("New review:",a)};return e.jsxs("section",{className:"offer__reviews reviews",children:[e.jsx(Q,{reviews:s}),r&&e.jsx(ee,{onSubmit:t})]})},se=re,ae=r=>r.nearby.offers,te=V(ae,r=>r.slice(0,F)),ne=r=>r.nearby.isNearbyOffersLoading,ie=r=>r.nearby.error,oe=r=>r.comments.comments,ce=r=>r.comments.isCommentsLoading,le=r=>r.comments.error,fe=r=>r.offer.offer,ue=r=>r.offer.isOfferLoading,me=r=>r.offer.error,de=r=>r.offer.errorStatus;function he({isAuth:r}){const{id:s}=L(),t=P(),a=_(fe),l=_(ue),f=_(me),i=_(de),n=_(te),o=_(ne),c=_(ie),d=_(oe),u=_(ce),m=_(le);if(j.useEffect(()=>{s&&(t(A(s)),t(z(s)),t(D(s)))},[t,s]),l||o||u)return e.jsx(M,{});if(i===404)return e.jsx($,{to:q.NotFound});if(f||c||m)return e.jsx(E,{});if(!a)return e.jsx(E,{});const v=`${Math.round(R(a))}%`,{host:h,images:g,goods:w}=a;return e.jsxs("div",{className:"page",children:[e.jsx(T,{}),e.jsxs("main",{className:"page__main page__main--offer",children:[e.jsxs("section",{className:"offer",children:[e.jsx("div",{className:"offer__gallery-container container",children:e.jsx("div",{className:"offer__gallery",children:g.slice(0,6).map(p=>e.jsx("div",{className:"offer__image-wrapper",children:e.jsx("img",{className:"offer__image",src:p,alt:"Photo studio"})},p))})}),e.jsx("div",{className:"offer__container container",children:e.jsxs("div",{className:"offer__wrapper",children:[a.isPremium&&e.jsx("div",{className:"offer__mark",children:e.jsx("span",{children:"Premium"})}),e.jsxs("div",{className:"offer__name-wrapper",children:[e.jsx("h1",{className:"offer__name",children:a.title}),e.jsxs("button",{className:"offer__bookmark-button button",type:"button",children:[e.jsx("svg",{className:"offer__bookmark-icon",width:"31",height:"33",children:e.jsx("use",{xlinkHref:"#icon-bookmark"})}),e.jsx("span",{className:"visually-hidden",children:"To bookmarks"})]})]}),e.jsxs("div",{className:"offer__rating rating",children:[e.jsxs("div",{className:"offer__stars rating__stars",children:[e.jsx("span",{style:{width:v}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]}),e.jsx("span",{className:"offer__rating-value rating__value",children:a.rating})]}),e.jsxs("ul",{className:"offer__features",children:[e.jsx("li",{className:"offer__feature offer__feature--entire",children:a.type}),e.jsxs("li",{className:"offer__feature offer__feature--bedrooms",children:[a.bedrooms," Bedrooms"]}),e.jsxs("li",{className:"offer__feature offer__feature--adults",children:["Max ",a.maxAdults," adults"]})]}),e.jsxs("div",{className:"offer__price",children:[e.jsxs("b",{className:"offer__price-value",children:["€",a.price]}),e.jsx("span",{className:"offer__price-text",children:" night"})]}),e.jsxs("div",{className:"offer__inside",children:[e.jsx("h2",{className:"offer__inside-title",children:"What's inside"}),e.jsx("ul",{className:"offer__inside-list",children:w.map(p=>e.jsx("li",{className:"offer__inside-item",children:p},p))})]}),e.jsxs("div",{className:"offer__host",children:[e.jsx("h2",{className:"offer__host-title",children:"Meet the host"}),e.jsxs("div",{className:"offer__host-user user",children:[e.jsx("div",{className:`offer__avatar-wrapper ${h.isPro?"offer__avatar-wrapper--pro":""} user__avatar-wrapper`,children:e.jsx("img",{className:"offer__avatar user__avatar",src:h.avatarUrl,width:"74",height:"74",alt:"Host avatar"})}),e.jsx("span",{className:"offer__user-name",children:h.name}),h.isPro&&e.jsx("span",{className:"offer__user-status",children:"Pro"})]}),e.jsx("div",{className:"offer__description",children:e.jsx("p",{className:"offer__text",children:a.description})})]}),e.jsx(se,{isAuth:r,reviews:d})]})}),e.jsx("section",{className:"offer__map map",children:e.jsx(I,{className:"offer__map",offers:[a,...n],activeOfferId:a.id})})]}),e.jsx(X,{offers:n,className:"near-places__list places__list"})]})]})}export{he as default};
